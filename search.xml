<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Azure Machine Learning Studio の parquet ファイルから作成したデータ アセットによる AutoML ジョブの [特徴量化の表示] における既知の問題について</title>
      <link href="/blog/2023/04/13/AML-automl-issue/"/>
      <url>/blog/2023/04/13/AML-automl-issue/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning Studio の AutoML ジョブにおいて確認されている既知の問題についてご紹介いたします。</p><span id="more"></span><br><hr><h2 id="既知の問題の概要"><a href="#既知の問題の概要" class="headerlink" title="既知の問題の概要"></a>既知の問題の概要</h2><p>Azure Machine Learning Studio から AutoML ジョブを作成する際に、parquet ファイルを使用したデータ アセットを選択した場合に [タスクと設定の選択] における [特徴量化の表示] 画面において表示されるカラムがデータ アセットのものではなく、作成に使用した parquet ファイルにおけるすべてのカラム表示されてしまう問題が確認されております。<br><br></p><h2 id="問題の詳細"><a href="#問題の詳細" class="headerlink" title="問題の詳細"></a>問題の詳細</h2><p>問題の詳細について具体的な例を挙げてご紹介いたします。<br>※ 使用するデータは Scikit Learn Toy Datasets の 1 つである <a href="https://scikit-learn.org/stable/datasets/toy_dataset.html#diabetes-dataset">Diabetes dataset</a> を使用しています。  </p><p>Azure Machine Learning Studio の [自動 ML] より画面にしたがって、自動 ML ジョブの作成を進めていきます。  </p><p>以下の例では、S4, S5, S6 および Y の 4 つのカラムを選択してデータ アセットを作成しています。  </p><p>&#x2F;&#x2F; parquet ファイルからカラムを選択してデータ アセットを作成<br><img src="https://jpmlblog.github.io/images/AML-automl-issue/azureml-parquet.png" width=500px align="left" border="1"><br clear="left"></p><p>preview を確認すると、作成時に選択した 4 つのカラム (S4, S5, S6 および Y) でデータ アセットが作成されていることが確認できます。</p><p>&#x2F;&#x2F; parquet ファイルから作成したデータ アセットのプレビュー<br><img src="https://jpmlblog.github.io/images/AML-automl-issue/azureml-parquet-preview.png" width=500px align="left" border="1"><br clear="left"></p><p>AutoML ジョブの設定を進めていくと [タスクと設定の選択] の [特徴量化の表示] を開くと、データ アセット作成時に選択したカラム (S4, S5, S6 および Y) 以外のカラムも表示されています。( parquet ファイルのすべてのカラムが表示されています。)</p><p>こちらが、本記事にてご紹介している不具合となります。</p><p>&#x2F;&#x2F; AutoML ジョブの [特徴量化の表示] の設定画面<br><img src="https://jpmlblog.github.io/images/AML-automl-issue/azureml-parquet-featurization.png" width=500px align="left" border="1"><br clear="left"></p><p>なお、csv ファイルを使用して同様な操作により作成したデータ アセットを使用した場合には、データ アセットのカラムのみ (S4, S5, S6 および Y) が表示されています。</p><p>&#x2F;&#x2F; csv ファイルから作成したデータ アセットによる [特徴量化の表示] の設定画面<br><img src="https://jpmlblog.github.io/images/AML-automl-issue/azureml-csv-featurization.png" width=500px align="left" border="1"><br clear="left"><br><br></p><h2 id="対応状況"><a href="#対応状況" class="headerlink" title="対応状況"></a>対応状況</h2><p>現在、本事象は Azure Machine Learning の修正予定の項目となっております。<br>しかしながら、現時点ではトレーニング自体は実施可能であるため、ご利用いただく際の運用によって対応していただく必要がございます。<br>大変恐れ入りますが、ご了承のほど何卒お願いいたします。</p><p>また、本事象が原因としたお客様のビジネス インパクトが多大なものである場合には、幣サポート チームより製品開発部門に対して、本機能の開発優先度をあげるようプッシュさせていただくことも可能です。<br>その際には具体的な損失金額や被害人数等の情報をご記載いただいたうえで、サポート リクエスト発行いただきご相談いただけますと幸いです。</p><p>Azure サポート リクエストを発行いただける際には 下記サイトをご参考いただけますと幸いです。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-create-azure-support-request">Azure サポート要求を作成する</a>  <br></li></ul><p>※ 一般的に、<a href="https://portal.azure.com/">Azure portal</a> の [ヘルプとサポート] から [新しいサポート リクエスト] を作成頂くことをお勧めいたします。</p><hr><p><code>変更履歴</code><br><code>2023/04/** created by Narita</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。 </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AutoML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning パイプラインを使用した自動機械学習ライフサイクルの例 (SDK v2)</title>
      <link href="/blog/2023/02/28/AML_example_pipeline_lifecycle_v2/"/>
      <url>/blog/2023/02/28/AML_example_pipeline_lifecycle_v2/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning SDK v2 を使用し、以下の Azure Machine Learning パイプラインの利用例について紹介させていただきます。今回紹介するライフサイクルは次の通りです。  </p><ul><li>自動機械学習を実行</li><li>ベスト モデルを選択して Managed Online Endpoint にデプロイ</li></ul><p>今後、以下が実行できるよう更新予定です。</p><ul><li>公開したパイプライン実行時に、データ アセットの最新バージョンを使用して AutoML が実行されるようにする</li><li>パイプライン実行毎に既存のエンドポイントが更新されるようにする</li></ul><span id="more"></span><br><hr><h2 id="イメージ"><a href="#イメージ" class="headerlink" title="イメージ"></a>イメージ</h2><p>&#x2F;&#x2F; ライフサイクルは以下のようなイメージです。これを参考に後述の手順をご確認ください。<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/lifecycle-image.png" width=900px align="left" border="1"><br clear="left">  </p><h2 id="準備"><a href="#準備" class="headerlink" title="準備"></a>準備</h2><p>以下リンクより sample-pipeline-sdkv2.zip ファイルをダウンロードし、ローカル上で解凍します。解凍後のフォルダーを、Azure Machine Learning Studio の Notebooks メニューのファイル ツリーのうち、任意の場所にアップロードします。</p><ul><li><a href="https://jpmlblog.github.io/files/AML_example_pipeline_lifecycle_v2/sample-pipeline-sdkv2.zip" title="sample-pipeline-sdkv2.zip">sample-pipeline-sdkv2.zip</a></li></ul><p>※ 保存されているファイル一覧<br>　・ data フォルダー<br>　　 ├ MLTable ファイル<br>　　 └ training-machine-dataset.csv ファイル<br>　・ aml-pipeline-sample-sdkv2.ipynb ファイル<br>　・ test.json ファイル  </p><p>&#x2F;&#x2F; フォルダーを配置した状態<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/folder_upload.png" width=700px align="left" border="1"><br clear="left">  </p><p>&#x2F;&#x2F; 上記ファイルを使って以下のような処理を行うパイプラインを作成します。<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/pipeline-image.png" width=700px align="left" border="1"><br clear="left">  </p><h2 id="ノートブックの実行"><a href="#ノートブックの実行" class="headerlink" title="ノートブックの実行"></a>ノートブックの実行</h2><p> sample-pipeline-sdkv2.zip の解凍後、aml-pipeline-sample-sdkv2.ipynb を選択し <code>[カーネルを再起動し、すべてのセルを実行する]</code> をクリックします。実行時には cpu-cluster という名前の STANDARD_DS3_V2 のコンピューティング クラスターが作成されます。既に存在する場合はそのコンピューティング クラスターを使用します。また、AutoML によって生成されたモデルをデプロイしたマネージド オンライン エンドポイントが作成されます。</p><p><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/execute-notebook.png" width=700px align="left" border="1"><br clear="left">  </p><h2 id="パイプラインの公開"><a href="#パイプラインの公開" class="headerlink" title="パイプラインの公開"></a>パイプラインの公開</h2><p>実行が終了すると、以下の通りエンドポイントとパイプラインが作成されるため、正常に実行が終了していることを確認して <code>[公開]</code> ボタンをクリックし、任意の名前で実行します。実行後、パイプライン エンドポイントが作成されます。(サンプル では automl_regression_and_deployment という名前になります。)  </p><p>&#x2F;&#x2F; ノートブックで定義したパイプラインの実行結果 (この画面で [公開] ボタンを押す)<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/created_pipeline.png" width=600px align="left" border="1"><br clear="left">  </p><p>&#x2F;&#x2F; 外部から呼び出せるように公開されたパイプラインのエンドポイント<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/published-pipeline.png" width=600px align="left" border="1"><br clear="left">  </p><p>&#x2F;&#x2F; 自動機械学習によって作成されたモデルをデプロイしたリアルタイム エンドポイント<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle_v2/created_endpoint.png" width=600px align="left" border="1"><br clear="left">  </p><hr><h2 id="パイプラインの使用"><a href="#パイプラインの使用" class="headerlink" title="パイプラインの使用"></a>パイプラインの使用</h2><p>※ 現在作成中となります。</p><hr><p><code>変更履歴</code><br><code>2023/02/28 created by Narita</code><br><code>2023/03/01 modified by Mochizuki</code>  </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> パイプライン </tag>
            
            <tag> ライフサイクル </tag>
            
            <tag> SDK v2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v2 API の有効化に伴う Azure Machine Learning Workspace への影響について</title>
      <link href="/blog/2022/05/18/AML_available-using-the-v2-API/"/>
      <url>/blog/2022/05/18/AML_available-using-the-v2-API/</url>
      
        <content type="html"><![CDATA[<p>件名 「Network Isolation Change with Our New API Platform on Azure Resource Manager」 の電子メールにて、Action Required to use new API platform with private link enabled workspace といった内容が通知されています。 このメールにおいて実際に必要な対応内容をお纏めして紹介します。  </p><p>(注意) 本情報は適宜調整しております。併せて下記公式サイトをご参照ください。  </p><ul><li><a href="http://aka.ms/amlv2network">Network Isolation Change with Our New API Platform on Azure Resource Manager</a></li></ul><span id="more"></span><br><hr><h2 id="v2-API-とは"><a href="#v2-API-とは" class="headerlink" title="v2 API とは"></a>v2 API とは</h2><p>Azure Machine Learning サービスで使用される API は、Azure Resource Manager (以下、ARM) 宛に要求を発行するもの、ワークスペース リソース宛に要求を発行するものの 2 種類が存在します。 これまでの API (v1 API) は、ワークスペースやコンピューティング リソースに対する操作以外は基本的にワークスペース宛に要求を送っていました。 新しい API (v2 API) では、それらの多くが ARM 宛に要求を送る様に変更されます。  </p><blockquote><table><thead><tr><th align="left">API バージョン&amp;nbsp;&amp;nbsp;&amp;nbsp;</th><th align="left">ARM 宛の操作</th><th align="left">Workspace 宛の操作</th></tr></thead><tbody><tr><td align="left">v1</td><td align="left">ワークスペースおよびコンピューティング リソースの作成、更新、削除操作</td><td align="left">実験などその他の操作</td></tr><tr><td align="left">v2</td><td align="left">ワークスペース、コンピューティング、データストア、データセット、ジョブ、環境、コード、&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>コンポーネント、エンドポイントなど、ほとんどの操作</td><td align="left">残りの操作</td></tr></tbody></table></blockquote><p>v2 API を使用することで、RBAC を使用したアクセス制御や Azure Policy の適用が使い易くなる見込みです。 また、Azure Machine Learning の <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-endpoints">マネージド オンライン エンドポイント</a> などの新機能は v2 API でしか使用できないため、これらが利用できるといったメリットもあります。  </p><hr><h2 id="v2-API-の使用によって発生するネットワーク分離への影響"><a href="#v2-API-の使用によって発生するネットワーク分離への影響" class="headerlink" title="v2 API の使用によって発生するネットワーク分離への影響"></a>v2 API の使用によって発生するネットワーク分離への影響</h2><p>前項で述べたように、API 操作には ARM を使用するものとワークスペースを使用するものがあり、v2 になることでその多くが ARM を使用するように変更されます。 プライベート エンドポイントを持たないワークスペースでは、ARM 宛とワークペース宛のいずれもパブリック ネットワークを経由して通信を行っているため、影響はありません。 プライベート エンドポイントを持つワークスペースでは、ワークスペース宛の通信は仮想ネットワーク内に閉じた通信になっていましたが、ARM 宛となることでほとんどの操作がパブリック ネットワーク経由となります。  </p><p>Azure のサービスから発信する ARM 宛の通信は、基本的に Azure Global Network 内には閉じています。 また、送信される情報はメタデータ (リソース ID など) やパラメータです。 例えば、<a href="https://docs.microsoft.com/ja-jp/rest/api/azureml/jobs/create-or-update">ジョブの作成や更新</a> で送信されるのは <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/reference-yaml-job-command">パラメーター</a> のみとなります。 ストレージ アカウント上の情報が含まれることは無く、また TLS 1.2 を使用して暗号化されているため読み取られる危険も低いです。  </p><p>以上から、基本的にこの変更がセキュリティに影響をあたえることは無いものと考えていますが、プライベート エンドポイントを持つ <strong>“既存の”</strong> ワークスペースについては影響の有無の判断の時間を設けるため、<code>v1_legacy_mode</code> パラメーターを用意し、予め True がセットされています。 これにより、v1 API の操作が継続されます。 なお、v2 API を使用する場合には <code>v1_legacy_mode</code> パラメーターを False にセットする必要があります。  </p><p>※ プライベート エンドポイントを持たない <strong>“既存の”</strong> ワークスペースは <code>v1_legacy_mode</code> パラメーターはセットされません (v2 API が使用される設定になります)。</p><hr><h2 id="v1-legacy-mode-パラメーターの設定値について"><a href="#v1-legacy-mode-パラメーターの設定値について" class="headerlink" title="v1_legacy_mode パラメーターの設定値について"></a><code>v1_legacy_mode</code> パラメーターの設定値について</h2><p>基本的に <code>v1_legacy_mode</code> パラメーターの設定条件は以下の通りです。 各シナリオとは異なるバージョンの API を使用したい場合には、後述の手順で変更ください。</p><h3 id="2022-4-30-以前に作成されたワークスペースの場合"><a href="#2022-4-30-以前に作成されたワークスペースの場合" class="headerlink" title="2022/4/30 以前に作成されたワークスペースの場合"></a><code>2022/4/30</code> 以前に作成されたワークスペースの場合</h3><ul><li>既定値は True</li><li>プライベート エンドポイントを持つ <strong>“既存の”</strong> ワークスペースでは <code>v1_legacy_mode</code> パラメーターに True がセット ⇒ v1 API</li><li>プライベート エンドポイントを持たない <strong>“既存の”</strong> ワークスペースでは <code>v1_legacy_mode</code> パラメーターに False がセット ⇒ v2 API (実際には何もセットされない場合があり、既定値が適用される可能性があります。 必要に応じて <code>v1_legacy_mode</code> パラメーターを手動で更新ください。)</li></ul><h3 id="2022-5-1-以降に作成されたワークスペースの場合"><a href="#2022-5-1-以降に作成されたワークスペースの場合" class="headerlink" title="2022/5/1 以降に作成されたワークスペースの場合"></a><code>2022/5/1</code> 以降に作成されたワークスペースの場合</h3><ul><li>既定値は False</li><li>プライベート エンドポイントを持つ <strong>“既存の”</strong> ワークスペースでは <code>v1_legacy_mode</code> パラメーターに True がセット ⇒ v1 API</li><li>プライベート エンドポイントを持たない <strong>“既存の”</strong> ワークスペースでは <code>v1_legacy_mode</code> パラメーターに False がセット ⇒ v2 API</li><li>新しく作成するワークスペースは <code>v1_legacy_mode</code> パラメーターに False がセット ⇒ v2 API</li></ul><hr><h2 id="v1-legacy-mode-パラメーターの確認・更新方法について"><a href="#v1-legacy-mode-パラメーターの確認・更新方法について" class="headerlink" title="v1_legacy_mode パラメーターの確認・更新方法について"></a><code>v1_legacy_mode</code> パラメーターの確認・更新方法について</h2><p>Azure Machine Learning 用の CLI 拡張機能 v1 (<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/reference-azure-machine-learning-cli">azure-cli-ml</a>) を使用する方法が簡単です。</p><ul><li><p>確認方法</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az ml workspace show <span class="literal">-g</span> &lt;myresourcegroup&gt; <span class="literal">-w</span> &lt;myworkspace&gt; <span class="literal">--query</span> v1LegacyMode</span><br></pre></td></tr></table></figure></li><li><p>更新方法</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az ml workspace update <span class="literal">-g</span> &lt;myresourcegroup&gt; <span class="literal">-w</span> &lt;myworkspace&gt; <span class="literal">--v1-legacy-mode</span> &lt;true or false&gt;</span><br></pre></td></tr></table></figure></li></ul><p>SDK で更新する場合には、以下のコードを実行することで更新が可能ですが、<code>2022/5/1</code> 以前に作成されたワークスペースでは実行がエラーになる場合があるため、CLI 拡張機能の使用をお勧めします。</p><ul><li>更新方法<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> azureml.core <span class="keyword">import</span> Workspace</span><br><span class="line"></span><br><span class="line">ws = Workspace.from_config()</span><br><span class="line">ws.update(v1_legacy_mode=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></li></ul><hr><p><code>変更履歴</code><br><code>2022/05/18 created by Mochizuki</code><br><code>2022/05/19 modified by Mochizuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> v2 API </tag>
            
            <tag> Private Endpoint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning パイプラインを使用した自動機械学習ライフサイクルの例</title>
      <link href="/blog/2021/10/21/AML_example_pipeline_lifecycle/"/>
      <url>/blog/2021/10/21/AML_example_pipeline_lifecycle/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning のライフサイクルを実現する Azure Machine Learning パイプラインの利用例について紹介させていただきます。今回紹介するライフサイクルは次の通りです。  </p><ul><li>ストレージ アカウント上の csv ファイル読み込み  </li><li>自動機械学習を実行</li><li>ベスト モデルを選択して ACI にデプロイ</li></ul><span id="more"></span><br><hr><h2 id="イメージ"><a href="#イメージ" class="headerlink" title="イメージ"></a>イメージ</h2><p>&#x2F;&#x2F; ライフサイクルは以下のようなイメージです。これを参考に後述の手順をご確認ください。<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/lifecycle-image.png" width=900px align="left" border="1"><br clear="left">  </p><h2 id="パイプラインの作成"><a href="#パイプラインの作成" class="headerlink" title="パイプラインの作成"></a>パイプラインの作成</h2><p>以下の図のように、データセットを入力として自動機械学習を実行し、作成されたモデルを登録、ACI Web エンドポイントを作成または更新するパイプラインを作成します。パイプラインの作成は、ノートブック ファイルの実行により行います。実行するノートブック ファイルと、使用するデータを以下リンクからダウンロードください。  </p><ul><li><a href="https://jpmlblog.github.io/files/AML_example_pipeline_lifecycle/aml-pipeline-sample_1.ipynb" title="aml-pipeline-sample_1.ipynb">aml-pipeline-sample_1.ipynb</a>  </li><li><a href="https://automlsamplenotebookdata.blob.core.windows.net/automl-sample-notebook-data/machineData.csv" title="machineData.csv">machineData.csv</a></li></ul><p>&#x2F;&#x2F; 上記ファイルを使って以下のような処理を行うパイプラインを作成します。<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/pipeline-image.png" width=700px align="left" border="1"><br clear="left">  </p><h3 id="データの配置"><a href="#データの配置" class="headerlink" title="データの配置"></a>データの配置</h3><p>ダウンロードした machineData.csv ファイルを、Azure Machine Learning ワークスペースの既定のストレージ アカウントのコンテナー <code>azureml-blobstore-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (xxx 部分はランダムな英数字)</code> 配下に <code>Datasets</code> フォルダーを作成し、アップロードしておきます。  </p><p><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/azureml-blobstore-container.png" width=700px align="left" border="1"><br clear="left">  </p><h3 id="ノートブックの実行"><a href="#ノートブックの実行" class="headerlink" title="ノートブックの実行"></a>ノートブックの実行</h3><p>aml-pipeline-sample_1.ipynb ファイルは、以下の通り Azure Machine Learning Studio の Notebooks のフォルダーにアップロードし、<code>[カーネルを再起動し、すべてのセルを実行する]</code> をクリックします。(実行時に cpu-cluster という名前の STANDARD_DS12_V2 のコンピューティング クラスターが作成されます。既に存在する場合はそのコンピューティング クラスターを使用します。)</p><p><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/azureml-studio-notebook.png" width=700px align="left" border="1"><br clear="left">  </p><h3 id="パイプラインの公開"><a href="#パイプラインの公開" class="headerlink" title="パイプラインの公開"></a>パイプラインの公開</h3><p>実行が終了すると、以下の通りエンドポイントとパイプラインが作成されるため、正常に実行が終了していることを確認して <code>[公開]</code> ボタンをクリックし、任意の名前で実行します。実行後、パイプライン エンドポイントが作成されます。(サンプル では pipeline_with_automlstep という名前になります。)  </p><p>&#x2F;&#x2F; 自動機械学習によって作成されたモデルをデプロイしたリアルタイム エンドポイント<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/azureml-studio-endpoint.png" width=600px align="left" border="1"><br clear="left">  </p><p>&#x2F;&#x2F; ノートブックで定義したパイプラインの実行結果 (この画面で [公開] ボタンを押す)<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/azureml-studio-pipeline.png" width=600px align="left" border="1"><br clear="left">  </p><p>&#x2F;&#x2F; 外部から呼び出せるように公開されたパイプラインのエンドポイント<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/azureml-studio-published-pipeline.png" width=600px align="left" border="1"><br clear="left">  </p><hr><h2 id="パイプラインの使用"><a href="#パイプラインの使用" class="headerlink" title="パイプラインの使用"></a>パイプラインの使用</h2><p>公開したパイプライン エンドポイントの REST エンドポイントに対し、POST メソッドで要求を送信するとパイプラインを実行されます。これにより、<code>azureml-blobstore-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (xxx 部分はランダムな英数字) / Datasets</code> フォルダー配下の machineData.csv ファイルを新しいファイルに変更してパイプラインを実行するだけで、新しいファイルを使用した自動機械学習、モデルの登録、ACI エンドポイントの作成を簡単に行うことが可能になります。  </p><p>&#x2F;&#x2F; REST エンドポイントは、公開されたパイプラインの概要ページより確認できます。<br><img src="https://jpmlblog.github.io/images/AML_example_pipeline_lifecycle/azureml-studio-published-pipeline-REST.png" width=850px align="left" border="1"><br clear="left">  </p><p>REST エンドポイントへの要求送信方法は多種ありますが、後述に Python および PowherShell を使用した実行方法を紹介させていただきます。  </p><h3 id="Python-での実行"><a href="#Python-での実行" class="headerlink" title="Python での実行"></a>Python での実行</h3><p>下記コードの &lt;公開したパイプラインの REST エンドポイント&gt; を上述の REST エンドポイント URL に置き換えて　Notebook 上から実行するだけで、パイプラインをトリガーすることが可能です。  </p><p>json 形式で実験名やパイプライン パラメーターを引数として渡すことが可能です。ただし、primary_metric は作りこみは不十分なので、変更する際には aml-pipeline-sample_1.ipynb ファイル側のロジックも含めて変更をご検討ください。  </p><ul><li>ExperimentName: 実験の名前</li><li>model_name: 登録されるモデルの名前</li><li>primary_metric: 自動機械学習のプライマリ メトリック</li><li>aciservice_name: ACI エンドポイントの名前</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> azureml.core.authentication <span class="keyword">import</span> InteractiveLoginAuthentication</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">auth = InteractiveLoginAuthentication()</span><br><span class="line">aad_token = auth.get_authentication_header()</span><br><span class="line"></span><br><span class="line">response = requests.post(<span class="string">&quot;&lt;公開したパイプラインの REST エンドポイント&gt;&quot;</span>,</span><br><span class="line">                         headers=aad_token,</span><br><span class="line">                         json=&#123;<span class="string">&quot;ExperimentName&quot;</span>: <span class="string">&quot;pipeline-cycle-test&quot;</span>,</span><br><span class="line">                               <span class="string">&quot;ParameterAssignments&quot;</span>: </span><br><span class="line">                               &#123;<span class="string">&quot;model_name&quot;</span>: <span class="string">&quot;automlmodel&quot;</span>,</span><br><span class="line">                               <span class="string">&quot;primary_metric&quot;</span>: <span class="string">&quot;r2_score&quot;</span>,</span><br><span class="line">                               <span class="string">&quot;aciservice_name&quot;</span>: <span class="string">&quot;aciservice&quot;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><h3 id="PowerShell-での実行"><a href="#PowerShell-での実行" class="headerlink" title="PowerShell での実行"></a>PowerShell での実行</h3><p>下記コマンドの &lt;公開したパイプラインの REST エンドポイント&gt; を上述の REST エンドポイント URL に置き換えて PowerShell コマンド プロンプト上で実行するだけで、パイプラインをトリガーすることが可能です。  </p><p>$postText で実験名やパイプライン パラメーターを引数として渡すことが可能です。Python での実行と同じように primary_metric を変更する際には aml-pipeline-sample_1.ipynb ファイル側のロジックも含めて変更をご検討ください。  </p><ul><li>ExperimentName: 実験の名前</li><li>model_name: 登録されるモデルの名前</li><li>primary_metric: 自動機械学習のプライマリ メトリック</li><li>aciservice_name: ACI エンドポイントの名前</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">az login</span><br><span class="line"></span><br><span class="line"><span class="variable">$aad_token</span> = az account <span class="built_in">get-access</span><span class="literal">-token</span></span><br><span class="line"><span class="variable">$convert_token</span> = <span class="variable">$aad_token</span> | <span class="built_in">ConvertFrom-Json</span></span><br><span class="line"><span class="variable">$parsed_token</span> = <span class="string">&quot;Bearer &quot;</span>+<span class="variable">$convert_token</span>.accessToken</span><br><span class="line"></span><br><span class="line"><span class="variable">$requestUri</span> = <span class="string">&quot;&lt;公開したパイプラインの REST エンドポイント&gt;&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$requestHeader</span> = <span class="selector-tag">@</span>&#123;</span><br><span class="line">  <span class="string">&#x27;Content-type&#x27;</span>=<span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  <span class="string">&#x27;authorization&#x27;</span> = <span class="variable">$parsed_token</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$postText</span> =  <span class="string">&quot;&#123;&quot;</span><span class="string">&quot;ExperimentName&quot;</span><span class="string">&quot;: &quot;</span><span class="string">&quot;pipeline-cycle-test&quot;</span><span class="string">&quot;,&quot;</span><span class="string">&quot;ParameterAssignments&quot;</span><span class="string">&quot;: &#123;&quot;</span><span class="string">&quot;model_name&quot;</span><span class="string">&quot;: &quot;</span><span class="string">&quot;automlmldel&quot;</span><span class="string">&quot;, &quot;</span><span class="string">&quot;primary_metric&quot;</span><span class="string">&quot;: &quot;</span><span class="string">&quot;r2_score&quot;</span><span class="string">&quot;, &quot;</span><span class="string">&quot;aciservice_name&quot;</span><span class="string">&quot;: &quot;</span><span class="string">&quot;aciservice&quot;</span><span class="string">&quot;&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$postBody</span> = [<span class="type">Text.Encoding</span>]::UTF8.GetBytes(<span class="variable">$postText</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Invoke-RestMethod</span> <span class="literal">-Method</span> POST <span class="literal">-Uri</span> <span class="variable">$requestUri</span> <span class="literal">-Headers</span> <span class="variable">$requestHeader</span> <span class="literal">-Body</span> <span class="variable">$postBody</span></span><br></pre></td></tr></table></figure><p>サービス プリンシパルを使用すると、ワークスペースに対してアクセス権のないユーザーでもパイプラインを実行できるようになります。まず、下記サイトの手順に従いアプリケーションの登録を行い、ワークスペース リソースに “共同作成者 (Contributor)” ロールを付与します。  </p><ul><li><a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/manage-azureml-service/authentication-in-azureml/authentication-in-azureml.ipynb">Authentication in Azure Machine Learning</a> ※ Service Principal Authentication セクションを参照ください。</li></ul><p>上述のコマンドのうち 1 行目を以下の通り変更して実行ください。  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az login <span class="literal">--service-principal</span> <span class="literal">-u</span> <span class="string">&quot;&lt;アプリケーション (クライアント) ID&gt;&quot;</span> <span class="literal">-p</span> <span class="string">&quot;&lt;クライアント シークレット&gt;&quot;</span> <span class="literal">--tenant</span> <span class="string">&quot;&lt;ディレクトリ (テナント) ID&gt;&quot;</span></span><br></pre></td></tr></table></figure><hr><p><code>変更履歴</code><br><code>2021/10/21 created by Mochizuki</code><br><code>2021/11/19 modified by Mochizuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> パイプライン </tag>
            
            <tag> ライフサイクル </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>名前に日本語を含むリソースグループを使用する場合の注意点について</title>
      <link href="/blog/2021/10/16/AML-resourcegroup-name/"/>
      <url>/blog/2021/10/16/AML-resourcegroup-name/</url>
      
        <content type="html"><![CDATA[<p>リソースグループ名に日本語 (例: 機械学習用リソースグループ) など 2 バイト文字が含まれる場合、当該リソースグループに Azure Machine Learning ワークスペースを作るといくつかの管理操作がエラーとなる場合がございます。これらの事例と、推奨する設定をお纏めいたします。 </p><span id="more"></span><br><hr><h2 id="確認できている事象について"><a href="#確認できている事象について" class="headerlink" title="確認できている事象について"></a>確認できている事象について</h2><p>日本語を含んだ名前のリソースグループを使用する場合、コントロール プレーン操作 (管理操作) や一部の UI 機能の実行がエラーとなることを確認しております。これは、操作の実行時に行われる認証処理など内部通信において、日本語を含むリソース ID を正しく認識できないことに起因して発生いたします。  </p><p>現在 (2021&#x2F;11&#x2F;08)、確認できている事象は以下の通りです。  </p><ul><li><del>自動機械学習の DNN オプションを使用できない</del> (※ 2021&#x2F;10&#x2F;19 修正済み)  </li><li><del>コンピューティング インスタンス起動 &#x2F; 停止が失敗する</del> (※ 2021&#x2F;11&#x2F;08 修正済み)  </li><li>コンピューティング インスタンスのスケジュール起動 &#x2F; 停止が動作しない</li></ul><p>また、ノートブックで Python コードを実行する際、こうしたリソース ID が使用されるような処理においても失敗する可能性がございます。オープンソースのモジュールで日本語など 2 バイト文字に対応していない場合、弊社にて修正および回避策を提示できない場合もございます。</p><hr><h2 id="推奨する設定について"><a href="#推奨する設定について" class="headerlink" title="推奨する設定について"></a>推奨する設定について</h2><p>Azure Machine Learning サービスに閉じた機能であれば修正リクエストをいただくことで適宜対処を検討させていただくことは可能ですが、対処の完了まで時間がかかる場合があり、また別のサービスとの連携を含む機能では修正が困難となる可能性もございます。<br>上記を踏まえまして、リソースグループ名は <strong>「英数字およびハイフンのみ」</strong> としていただくことを強く推奨いたします。  </p><p>※ ワークスペースおよびコンピューティング リソースに関する名前付け制限は以下をご参照ください。</p><p><a href="https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/management/resource-name-rules#microsoftmachinelearningservices">Azure リソースの名前付け規則と制限事項 #Microsoft.MachineLearningServices</a>  </p><blockquote><table><thead><tr><th align="left">Entity</th><th align="left">Scope</th><th align="left">長さ</th><th align="left">有効な文字</th></tr></thead><tbody><tr><td align="left">workspaces&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">resource group&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">3-33&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">英数字とハイフン。</td></tr><tr><td align="left">workspaces &#x2F; computes&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">ワークスペース&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">2-16&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">英数字とハイフン。</td></tr></tbody></table></blockquote><hr><p><code>変更履歴</code><br><code>2021/10/16 created by Mochizuki</code><br><code>2021/10/19 modified by Mochizuki</code><br><code>2021/11/08 modified by Mochizuki</code>  </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 日本語 </tag>
            
            <tag> リソースグループ </tag>
            
            <tag> コンピューティング インスタンス </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning Studio (classic) のサービス終了について</title>
      <link href="/blog/2021/08/25/AMLSC-service-retirement/"/>
      <url>/blog/2021/08/25/AMLSC-service-retirement/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning Studio (classic) は、2024 年 8 月 31 日を持ちましてサービスを終了いたします。関連する公開情報や留意事項についてご紹介させていただきます。  </p><ul><li><a href="https://azure.microsoft.com/en-us/updates/machine-learning-studio-classic-will-retire-on-31-august-2024/">Machine Learning Studio (classic) will retire on 31 August 2024</a></li></ul><span id="more"></span><hr><h2 id="サービス終了までの段階的制限"><a href="#サービス終了までの段階的制限" class="headerlink" title="サービス終了までの段階的制限"></a>サービス終了までの段階的制限</h2><table><thead><tr><th align="left">日時</th><th align="left">サービスの制限</th></tr></thead><tbody><tr><td align="left">2021 年 8 月 24 日以降&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">公開ドキュメント・不具合等の修正は基本的に対応不可</td></tr><tr><td align="left">2021 年 12 月 1 日以降&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">新規リソースの作成不可</td></tr><tr><td align="left">2024 年 8 月 31 日以降&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">リソース使用不可</td></tr></tbody></table><p>※ 影響の大きな不具合は修正される可能性があります。  </p><hr><h2 id="対象リソース"><a href="#対象リソース" class="headerlink" title="対象リソース"></a>対象リソース</h2><ul><li>Azure Machine Learning Studio (classic) workspaces</li><li>Azure Machine Learning Studio (classic) Web services </li><li>Azure Machine Learning Studio (classic) Web service plans</li></ul><p>※ Azure ポータルの言語設定が日本語の場合、”(classic)” が省略されております。  </p><hr><h2 id="移行方法"><a href="#移行方法" class="headerlink" title="移行方法"></a>移行方法</h2><p>移行に関する手順は以下公開情報に纏められております。当該ドキュメントは今後更新される可能性がございますので、適宜ご参照ください。  </p><ul><li><a href="https://docs.microsoft.com/en-us/azure/machine-learning/migrate-overview">Migrate to Azure Machine Learning</a></li></ul><p>基本的に、Azure Machine Learning Studio (classic) で使用していた機能を、移行先サービス Azure Machine Learning Service で再作成する方針となります。ボタン一つでまとめて移行できるようなものではないため、期間的に十分な余裕をもって実行いただくことをお勧めいたします。  </p><blockquote><p>移行先のサービスとの比較に関する情報は下記公開情報に纏められております。<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/overview-what-is-machine-learning-studio#ml-studio-classic-vs-azure-machine-learning-studio">ML Studio (classic) と Azure Machine Learning スタジオ</a>  </p></blockquote><hr><h2 id="留意事項"><a href="#留意事項" class="headerlink" title="留意事項"></a>留意事項</h2><p>ワークスペースに関連付けされている Web service plans リソースを先に削除したり、そのほか予期しない操作によってリソースの削除が完全に行われず、課金が継続して発生してしまうといったお問い合わせが複数件報告されています。  </p><p>リソースを削除後、課金情報にリソース プロバイダー “Microsoft.MachineLearning” に関する料金が継続して累積されている場合には、以下記事の情報を参考にサポート リクエストを発行いただきますようお願いいたします。  </p><ul><li><a href="https://jpmlblog.github.io/blog/2020/06/09/AMLSC-cannot-delete/">Azure Machine Learning Studio (Classic) ワークスペースを削除できない事象について</a></li></ul><hr><p><code>変更履歴</code><br><code>2021/08/25 created by Mochizuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning Studio (classic) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> サービス終了 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning Studio で参照可能なデータの格納場所について</title>
      <link href="/blog/2021/06/16/AML-storage-data-location/"/>
      <url>/blog/2021/06/16/AML-storage-data-location/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning Studio で作成した実験用ノートブック ファイルやスクリプト、実験時のログ、アップロードしたファイルなどは、Azure Machine Learning ワークスペース既定のストレージ アカウントに格納されます。お問い合わせをいただくことが多い格納先について紹介します。  </p><span id="more"></span><br><hr><h2 id="Notebooks-メニューから参照可能なファイル"><a href="#Notebooks-メニューから参照可能なファイル" class="headerlink" title="Notebooks メニューから参照可能なファイル"></a>Notebooks メニューから参照可能なファイル</h2><p>Azure Machine Learning Studio の [Notebooks] メニューより参照可能なファイルやフォルダーは、ワークスペースが既定で使用するストレージ アカウントの [ファイル共有] の <code>code-&lt;GUID&gt;/Users</code> 配下に格納されます。  </p><p>また、このファイル共有はコンピューティング インスタンスにログオンした時に、<code>/mnt/batch/tasks/shared/LS_root/mounts/clusters/&#123;コンピューティング インスタンス名&#125;/code</code> というパスに自動でマウントされます。    </p><ul><li><p>例: Azure Machine Learning Studio の [Notebooks] メニューのフォルダー ツリー  </p><p> <img src="https://jpmlblog.github.io/images/AML-data-location/AML-UI-notebooks.png" width=350px align="left"><br clear="left">  </p></li><li><p>例: ストレージ アカウントの [ファイル共有] <code>code-&lt;GUID&gt;/Users</code> 配下  </p><p> <img src="https://jpmlblog.github.io/images/AML-data-location/AML-Fileshare-code.png" width=500px align="left"><br clear="left">  </p></li><li><p>例: コンピューティング インスタンスの <code>/mnt/batch/tasks/shared/LS_root/mounts/clusters/&#123;コンピューティング インスタンス名&#125;/code</code> 配下</p><p> <img src="https://jpmlblog.github.io/images/AML-data-location/AML-UI-terminal.png" width=700px align="left"><br clear="left"></p></li></ul><hr><h2 id="実験の成果物"><a href="#実験の成果物" class="headerlink" title="実験の成果物"></a>実験の成果物</h2><p>Azure Machine Learning Studio の [実験] メニューより参照可能な成果物 (ログ ファイルやモデル ファイル等) は、ワークスペースが既定で使用するストレージ アカウントの [Blob コンテナー] の <code>azureml/ExperimentRun/dcid.&lt;実行 ID&gt;</code> 配下に格納されます。  </p><ul><li><p>例: Azure Machine Learning Studio の [実験] メニューの [詳細] タブ  </p><p> <img src="https://jpmlblog.github.io/images/AML-data-location/AML-UI-experiment-detail.png" width=500px align="left"><br clear="left">  </p></li><li><p>例: Azure Machine Learning Studio の [実験] メニューの [出力とログ] タブ  </p><p> <img src="https://jpmlblog.github.io\images\AML-data-location\AML-UI-experiment-output.png" width=600px align="left"><br clear="left">  </p></li><li><p>例: ストレージ アカウントの [Blob コンテナー] <code>azureml/ExperimentRun/dcid.&lt;実行 ID&gt;</code> 配下  </p><p> <img src="https://jpmlblog.github.io\images\AML-data-location\AML-Blob-experimentrun.png" width=600px align="left"><br clear="left"></p></li></ul><hr><p>※ 適宜追加予定です。</p><hr><p><code>変更履歴</code><br><code>2021/6/16 created by Mochizuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blob コンテナー </tag>
            
            <tag> ファイル共有 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure MachineLeaning Studio の Notebooks メニューにおける「現時点ではこれにはアクセスできません」エラーへの対応方法</title>
      <link href="/blog/2021/03/29/AML-cannot-use-notebook/"/>
      <url>/blog/2021/03/29/AML-cannot-use-notebook/</url>
      
        <content type="html"><![CDATA[<p>本記事では、Azure MachineLeaning Studio の Notebooks メニューで開いた Notebook で処理を実行した際に「現時点ではこれにはアクセスできません」とエラーメッセージが表示されてしまう場合の対応方法をご案内します。</p><span id="more"></span><br><hr><h1 id="対応方法"><a href="#対応方法" class="headerlink" title="対応方法"></a>対応方法</h1><h2 id="Azure-MachineLeaning-Studio-の-Compute-メニュー利用による回避"><a href="#Azure-MachineLeaning-Studio-の-Compute-メニュー利用による回避" class="headerlink" title="Azure MachineLeaning Studio の Compute メニュー利用による回避"></a>Azure MachineLeaning Studio の Compute メニュー利用による回避</h2><p>Azure MachineLeaning Studio（以下 AML Studio） の Notebooks メニュー使用時に、権限に関するエラーが表示される場合があります。  </p><img src="https://jpmlblog.github.io/images/AML-cannot-use-notebook/error_message.jpg" width=400px border="1">  <p>原因は Azure Active Directory 側の設定に依存する可能性がありますが、コンピューティング メニュー のアプリケーション URI 配下のメニューから Notebook を開き直す対応で、問題が解消する場合があります。  </p><img src="https://jpmlblog.github.io/images/AML-cannot-use-notebook/notebook1.jpg" width=800px border="1">  <br>  <p>Notebooks メニューと コンピューティング メニューにおいてはそれぞれのバックエンドの認証方法が異なります。<br>そのため、コンピューティング メニューから Notebook を実行した場合には、AML Studio への認証情報がコンピューティングインスタンスに連携されて権限エラーが生じない可能性があります。  </p><p>なお、AML Studio を通じて配置された Notebook などのファイルが存在する階層の実体は、AMLワークスペース既定のストレージアカウントです。　　</p><p>（コンピューティングインスタンス内部から参照した際のパス例： &#x2F;mnt&#x2F;batch&#x2F;tasks&#x2F;shared&#x2F;LS_root&#x2F;mounts&#x2F;clusters&#x2F;{コンピューティングインスタンス名}&#x2F;code&#x2F;Users&#x2F;{ユーザー名}）　　</p><p>そのため、Notebooksメニューと コンピューティング メニューのどちらのメニューを通じた利用でも、ファイルの数や内容は同じです。<br>もし、コンピューティング メニューの利用で問題が解消する場合には、こちらの回避策の利用のご検討をいただければ幸いです。  </p><p>もし、コンピューティング メニュー利用による問題の回避が行えない場合には、次項の「Azure Active Directory へのネームドロケーションの登録追加」対応をご検討ください。</p><h2 id="Azure-Active-Directory-へのネームドロケーションの登録追加"><a href="#Azure-Active-Directory-へのネームドロケーションの登録追加" class="headerlink" title="Azure Active Directory へのネームドロケーションの登録追加"></a>Azure Active Directory へのネームドロケーションの登録追加</h2><p>「アクセスできません」というエラーの権限の問題の根本的な対応として、テナント（Azure Active Directory）管理者様により、該当するコンピューティング インスタンスのIPアドレスをネームドロケーションとして追加登録していただくことで、問題が解消される可能性があります。</p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/quickstart-configure-named-locations">- クイック スタート:Azure Active Directory でネームド ロケーションを構成する</a></p><blockquote><p>ネームド ロケーションを使うと、組織内の信頼できる IP アドレス範囲にラベルを付けることができます。Azure AD では、次のためにネームド ロケーションを使用します。<br>　・リスク検出で誤判定を検出する。 信頼できる場所からサインインすることで、ユーザーのサインイン リスクが低下します。<br>　・場所ベースの条件付きアクセスを構成する。<br>このクイック スタートでは、環境内でネームド ロケーションを構成する方法について説明します。</p></blockquote><p>追加登録対象となるコンピューティングインスタンスのIPアドレスは、AMLスタジオ の Compute メニューで確認可能です。  </p><img src="https://jpmlblog.github.io/images/AML-cannot-use-notebook/notebook2.jpg" width=800px border="1">  <br><hr><h1 id="エラーメッセージが表示される原因"><a href="#エラーメッセージが表示される原因" class="headerlink" title="エラーメッセージが表示される原因"></a>エラーメッセージが表示される原因</h1><h2 id="「条件付きアクセス」の設定"><a href="#「条件付きアクセス」の設定" class="headerlink" title="「条件付きアクセス」の設定"></a>「条件付きアクセス」の設定</h2><p>コンピューティングインスタンスが不詳なデバイスとして認識され、組織データである Azure ML ワークスペースへのアクセスが叶わないことが、エラーの原因となっている可能性があります。<br>「条件付きアクセス」の設定については、弊社 Azure Active Directory サポートチームがブログ記事に詳細を記載しています。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/conditional-cannot-access-rightnow/"> - Japan Azure Identity Support Blog-「現時点ではこれにはアクセスできません」 エラーについて</a></p><p>これは Azure Machine Learning の設定ではなく、テナント（Azure Active Directory）管理者による設定です。<br>そのため、まずはテナント管理者様に設定条件をご確認いただく必要があります。</p><hr><p><code>変更履歴</code><br><code>2021/03/29 created by Uehara</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Notebook </tag>
            
            <tag> 権限 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning で作成したモデルの推論を実行する方法について</title>
      <link href="/blog/2021/01/13/AML-model-inference/"/>
      <url>/blog/2021/01/13/AML-model-inference/</url>
      
        <content type="html"><![CDATA[<p>本記事では、Azure Machne Learning で作成したモデルを SDK を使用して推論実行する方法を紹介します。<br>試験的に作成したモデルの評価を行う場合には、都度 Web サービスにデプロイする方法は効率的ではないため、ローカルにロードして推論実行する手順を紹介します。また、Web サービスにデプロイして推論を実行する方法についても併せて紹介します。  </p><span id="more"></span><br><hr><h2 id="ローカルにモデルをロードして評価を行う場合"><a href="#ローカルにモデルをロードして評価を行う場合" class="headerlink" title="ローカルにモデルをロードして評価を行う場合"></a>ローカルにモデルをロードして評価を行う場合</h2><p>実験によって作成されたモデルのテストを行う場合、ローカル環境にロードして実行する方法をお勧めいたします。以下に、自動機械学習のチュートリアルの実行によって作成されたモデルを例にご紹介いたします。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/tutorial-first-experiment-automated-ml">チュートリアル:Azure Machine Learning の自動 ML で分類モデルを作成する</a></li></ul><p>自動機械学習では、複数のアルゴリズムと前処理の組み合わせを試し、それぞれの実行でモデルを作成します。上記チュートリアルのとおりに実行すると、「my-1st-automl-experiment」 という名前の実験の中で、複数のモデルが作成されます。このうちひとつのモデルをローカルにロードして、推論実行する方法を紹介します。  </p><p>モデルは、VotingEnsemble を選択します。  </p><p><img src="https://jpmlblog.github.io/images/AML-model-inference/AML-algorithm-list.png" width=800px align="left" border="1"><br clear="left">  </p><p>「詳細」 タブより実行 ID を確認します。  </p><p><img src="https://jpmlblog.github.io/images/AML-model-inference/AML-algorithm-details.png" width=500px align="left" border="1"><br clear="left">  </p><p>Notebooks メニューより任意のフォルダーに新しいノートブックを作成し、以下のコードを入力、実行します。experiment_name や run_id は、ご利用環境に合わせて適宜変更ください。  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 実行 ID より Run オブジェクトを作成します。</span></span><br><span class="line"><span class="keyword">from</span> azureml.core <span class="keyword">import</span> Experiment, Workspace</span><br><span class="line"><span class="keyword">from</span> azureml.core.experiment <span class="keyword">import</span> Experiment</span><br><span class="line"><span class="keyword">from</span> azureml.core.run <span class="keyword">import</span> Run</span><br><span class="line"></span><br><span class="line">workspace = Workspace.from_config()</span><br><span class="line">experiment_name = <span class="string">&quot;my-1st-automl-experiment&quot;</span></span><br><span class="line">experiment = Experiment(workspace, experiment_name)</span><br><span class="line">run = Run(experiment=experiment, run_id=<span class="string">&#x27;AutoML_66d0eb73-e09c-435d-ae80-da060d204b09_69&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># モデル等の情報を download フォルダー配下に格納します。</span></span><br><span class="line">run.download_files(output_directory=<span class="string">&#x27;download&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ダウンロードしたモデルをローカルにロードします。</span></span><br><span class="line"><span class="keyword">import</span> joblib</span><br><span class="line"><span class="keyword">from</span> azureml.core.model <span class="keyword">import</span> Model</span><br><span class="line"></span><br><span class="line">model_path = <span class="string">&#x27;download/outputs/model.pkl&#x27;</span></span><br><span class="line">model = joblib.load(model_path)</span><br></pre></td></tr></table></figure><p>推論のテストに使用するデータは、トレーニング データに含まれていないものをご用意頂く必要があります。今回は既に用意されているテスト データを使用しますが、一般的にはトレーニング用に収集したデータの 1 割程度をテスト用に分割しておくことをお勧めします。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># チュートリアルのテスト用データをデータセットとして読み込みます。</span></span><br><span class="line"><span class="keyword">from</span> azureml.core.dataset <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line">test_data = <span class="string">&quot;https://automlsamplenotebookdata.blob.core.windows.net/automl-sample-notebook-data/bankmarketing_test.csv&quot;</span></span><br><span class="line">test_dataset = Dataset.Tabular.from_delimited_files(test_data)</span><br></pre></td></tr></table></figure><blockquote><p>既存のデータセットを使用する場合、上記コード セルを以下に変更します。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment"># 既存のデータセットを読み込みます。</span></span><br><span class="line">&gt;<span class="keyword">from</span> azureml.core.dataset <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line">&gt;<span class="comment"># detaset_name をデータセット名に置き換えて実行します。</span></span><br><span class="line">&gt;test_dataset = Dataset.get_by_name(workspace, &gt;name=<span class="string">&#x27;bankmarketing_test&#x27;</span>)</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># y 列を削除して pandas のデータフレーム形式に変換します。</span></span><br><span class="line">test = test_dataset.drop_columns(columns=[<span class="string">&#x27;y&#x27;</span>])</span><br><span class="line">test_df = test.to_pandas_dataframe()</span><br><span class="line"></span><br><span class="line"><span class="comment"># predict メソッドを使用して推論を実行します。</span></span><br><span class="line">pred  = model.predict(test_df)</span><br><span class="line">pred.tolist()</span><br></pre></td></tr></table></figure><p>以下の通り推論結果を表示できたかと思います。  </p><p><img src="https://jpmlblog.github.io/images/AML-model-inference/AML-inference-result.png" width=700px align="left" border="1"><br clear="left">  </p><p>これらのコードは下記サンプル ノートブック <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/classification-bank-marketing-all-features/auto-ml-classification-bank-marketing-all-features.ipynb">auto-ml-classification-bank-marketing-all-features.ipynb</a> を参考にしておりますので、併せて参照ください。 </p><blockquote><p><strong>注意点</strong><br>時系列予測モデルの ForecastingParameters として target_rolling_window_size パラメーターを指定していると、predict の実行が失敗することが確認できています。これは predict メソッドが target_rolling_window_size パラメーターを使用したモデルでの実行をサポートしていないためです。このような場合、以下サンプル ノートブック <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/automated-machine-learning/forecasting-orange-juice-sales/auto-ml-forecasting-orange-juice-sales.ipynb">auto-ml-forecasting-orange-juice-sales.ipynb</a> 、にありますとおり、predict メソッドではなく forecast メソッドの利用をご検討ください。<br><img src="https://jpmlblog.github.io/images/AML-model-inference/AML-forecasting-sample.png" width=800px align="left" border="1"><br clear="left">  </p></blockquote><hr><h2 id="Web-サービスとしてデプロイされたモデルを使用する"><a href="#Web-サービスとしてデプロイされたモデルを使用する" class="headerlink" title="Web サービスとしてデプロイされたモデルを使用する"></a>Web サービスとしてデプロイされたモデルを使用する</h2><p>作成したモデルをローカル、ACI、AKS のいずれかに Web サービスとしてデプロイした場合、要求データを REST エンドポイントに対して送信することで推論結果を得られます。  </p><p>モデルのデプロイ方法は下記公開情報に纏められています。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-and-where?tabs=azcli">Azure Machine Learning を使用してモデルをデプロイする</a></li></ul><p>デプロイした Web サービスの呼び出し方は、下記公開情報が参考になります。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-consume-web-service?tabs=python">Web サービスとしてデプロイされた Azure Machine Learning モデルを使用する</a></li></ul><p>デプロイ先がローカル、ACI、AKS それぞれのドキュメントおよびサンプル ノートブックを紹介します。  </p><h3 id="ローカル"><a href="#ローカル" class="headerlink" title="ローカル"></a>ローカル</h3><ul><li>docs: <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-local-container-notebook-vm">Azure Machine Learning コンピューティング インスタンスへのモデルのデプロイ</a>  </li><li>sample: <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/deploy-to-local/register-model-deploy-local-advanced.ipynb">Register model and deploy locally with advanced usages</a></li></ul><h3 id="ACI-Azure-Container-Instance"><a href="#ACI-Azure-Container-Instance" class="headerlink" title="ACI (Azure Container Instance)"></a>ACI (Azure Container Instance)</h3><ul><li>docs: <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-azure-container-instance">Azure Container Instances にモデルをデプロイする</a>  </li><li>sample: <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/deploy-to-cloud/model-register-and-deploy.ipynb">Register model and deploy as webservice in ACI</a>  </li><li>sample: <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/deploy-multi-model/multi-model-register-and-deploy.ipynb">Deploy Multiple Models as Webservice</a></li></ul><h3 id="AKS-Azure-Kubernetes-Service"><a href="#AKS-Azure-Kubernetes-Service" class="headerlink" title="AKS (Azure Kubernetes Service)"></a>AKS (Azure Kubernetes Service)</h3><ul><li>docs: <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-azure-kubernetes-service?tabs=python">Azure Kubernetes Service クラスターにモデルをデプロイする</a>  </li><li>sample: <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/production-deploy-to-aks/production-deploy-to-aks.ipynb">Deploying a web service to Azure Kubernetes Service (AKS)</a>  </li><li>sample: <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/production-deploy-to-aks/production-deploy-to-aks-ssl.ipynb">Deploying a web service to Azure Kubernetes Service (AKS) + SSL</a>  </li><li>sample: <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/deployment/production-deploy-to-aks-gpu/production-deploy-to-aks-gpu.ipynb">Deploying a web service to Azure Kubernetes Service (AKS) + GPU</a></li></ul><hr><h2 id="そのほか参考となる情報"><a href="#そのほか参考となる情報" class="headerlink" title="そのほか参考となる情報"></a>そのほか参考となる情報</h2><h3 id="Web-サービスの入力データについて"><a href="#Web-サービスの入力データについて" class="headerlink" title="Web サービスの入力データについて"></a>Web サービスの入力データについて</h3><p>Web サービスを呼び出す Json データは、{“data”: [[ 数値,数値, … ], [ 数値,数値, … ]]} という形式である必要があります。または、辞書形式で {“data”: [{ “列名”:数値, “列名”:数値, … }, { “列名”:数値, “列名”:数値, … }]} としても推論を実行可能です。  </p><p>以下に、csv ファイルを入力データに変更する方法を紹介させていただきます。まず、下記のコードで推論用データ predictdata.csv を作成します。事前に作成されたデータを使用しても問題ありません。  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%%writefile predictdata.csv</span><br><span class="line">Name,age,job,hobby,deposit</span><br><span class="line">test1,<span class="number">15</span>,none,car,<span class="number">150000</span></span><br><span class="line">test2,<span class="number">28</span>,office worker,<span class="number">200000</span></span><br><span class="line">test3,<span class="number">35</span>,bank,fishing,<span class="number">3600000</span></span><br><span class="line">test4,<span class="number">40</span>,journalist,<span class="number">1520000</span></span><br></pre></td></tr></table></figure><p>下記コードにて、入力用のデータへ変換します。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">json_list = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># CSV ファイルの読み込み</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;predictdata.csv&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> csv.DictReader(f):</span><br><span class="line">        json_list.append(row)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON ファイルへの書き込み</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;predict.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(json_list, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON ファイルのロード</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;predict.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json_output = json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 入力用データへの成型</span></span><br><span class="line">data = &#123;<span class="string">&#x27;data&#x27;</span>: [json_output]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># String 形式に変換</span></span><br><span class="line">input_data = json.dumps(data)</span><br></pre></td></tr></table></figure><p>このとき、input_data 以下の通りです。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#123;&quot;data&quot;: [[&#123;&quot;Name&quot;: &quot;test1&quot;, &quot;age&quot;: &quot;15&quot;, &quot;job&quot;: &quot;none&quot;, &quot;hobby&quot;: &quot;car&quot;, &quot;deposit&quot;: &quot;150000&quot;&#125;, &#123;&quot;Name&quot;: &quot;test2&quot;, &quot;age&quot;: &quot;28&quot;, &quot;job&quot;: &quot;office worker&quot;, &quot;hobby&quot;: &quot;200000&quot;, &quot;deposit&quot;: null&#125;, &#123;&quot;Name&quot;: &quot;test3&quot;, &quot;age&quot;: &quot;35&quot;, &quot;job&quot;: &quot;bank&quot;, &quot;hobby&quot;: &quot;fishing&quot;, &quot;deposit&quot;: &quot;3600000&quot;&#125;, &#123;&quot;Name&quot;: &quot;test4&quot;, &quot;age&quot;: &quot;40&quot;, &quot;job&quot;: &quot;journalist&quot;, &quot;hobby&quot;: &quot;1520000&quot;, &quot;deposit&quot;: null&#125;]]&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="デザイナーで作成したモデルのデプロイ"><a href="#デザイナーで作成したモデルのデプロイ" class="headerlink" title="デザイナーで作成したモデルのデプロイ"></a>デザイナーで作成したモデルのデプロイ</h3><p>デザイナーでは作成したパイプラインを公開するだけではなく、作成したモデルをデプロイする方法がございます。以下公開情報に纏められておりますので、参考にご参照ください。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-model-designer">スタジオを使用して、デザイナーでトレーニングされたモデルをデプロイする</a></li></ul><hr><p><code>変更履歴</code><br><code>2021/01/13 created by Mochizuki</code><br><code>2021/01/21 created by Mochizuki</code>  </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> モデル デプロイ </tag>
            
            <tag> 推論 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自動機械学習 (AutoML) の分類タスクのディープ ラーニング有効化について</title>
      <link href="/blog/2020/12/24/AML-deep-learning-for-automl/"/>
      <url>/blog/2020/12/24/AML-deep-learning-for-automl/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning Studio から自動機械学習を実行する際、”ディープ ラーニングの有効化” のチェックを入れた場合の動作について紹介いたします。</p><span id="more"></span><br><hr><p>Azure Machine Learning Studio (<a href="https://ml.azure.com/">https://ml.azure.com/</a>) では、UI ベースで自動機械学習を実行することが出来ます。詳細な手順は以下の公開情報を参照ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-use-automated-ml-for-ml-models">Azure Machine Learning を使用して自動機械学習モデルを作成、確認、デプロイする</a></li></ul><p>選択できるタスクは、分類、回帰、時系列の 3 つがあります。この時、分類タスクの “ディープ ラーニングの有効化” にチェックを入れることで、<strong>テキスト データの特徴付け</strong> に有効な BERT または BiLSTM を適用することが可能です。  </p><p><img src="https://jpmlblog.github.io/images/AML-deep-learning-for-automl/enable-deep-learning-for-classification.png" alt="enable-deep-learning-for-classification.png"></p><p>BERT を適用する場合、コンピューティング クラスターに GPU コンピューティング (例: VM サイズ “STANDARD_NC6”、またはそれ以上の GPU) を使用する必要があります。CPU コンピューティングを使用した場合には、BiLSTM DNN 特徴抽出器が有効になります。詳細は以下の公開情報をご確認ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-configure-auto-features#bert-integration">BERT 統合</a></li></ul><p>その他、参考となる公開情報をお纏めします。  </p><ul><li><a href="https://techcommunity.microsoft.com/t5/azure-ai/how-bert-is-integrated-into-azure-automated-machine-learning/ba-p/1194657">How BERT is integrated into Azure automated machine learning</a></li><li><a href="https://docs.microsoft.com/en-us/python/api/azureml-automl-runtime/azureml.automl.runtime.featurizer.transformer.text.pretrained_text_dnn_transformer?view=azure-ml-py">AutoML SDK - pretrained_text_dnn_transformer Module</a></li><li><a href="https://docs.microsoft.com/en-us/python/api/azureml-automl-runtime/azureml.automl.runtime.featurizer.transformer.text.bilstm_attention_transformer?view=azure-ml-py">AutoML SDK - bilstm_attention_transformer Module</a></li><li><a href="https://github.com/Microsoft/AzureML-BERT">GitHub - microsoft&#x2F;AzureML-BERT</a></li><li><a href="https://github.com/google-research/bert">GitHub - google-research&#x2F;bert</a></li><li><a href="https://github.com/huggingface/transformers">GitHub - huggingface&#x2F;transformers</a></li></ul><hr><p><code>変更履歴</code><br><code>2020/12/24 created by Mochizuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Automated Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Functions を使用してパイプラインを定期的に実行する方法について</title>
      <link href="/blog/2020/11/30/AML-scheduled-pipeline/"/>
      <url>/blog/2020/11/30/AML-scheduled-pipeline/</url>
      
        <content type="html"><![CDATA[<p>Azure Functions のタイマー トリガーを使用して、Azure Machine Learning で発行されたパイプラインを定期的に実行する方法を紹介します。</p><span id="more"></span><br><hr><p>Azure Machine Learning で発行されたパイプラインを定期的に実行する方法は、以下の 3 つが考えられます。<br>&amp;emsp;A. <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-schedule-pipelines">Azure Machine Learning SDK for Python を使用して機械学習パイプラインのスケジュールを設定する</a><br>&amp;emsp;B. <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-trigger-published-pipeline">ロジック アプリから Machine Learning パイプラインの実行をトリガーする</a><br>&amp;emsp;C. Azure Functions を使用してパイプラインを定期的に実行する</p><p>C については、詳細な手順を紹介する公開ドキュメントがないため、本記事では C 方法を紹介します。</p><p>(参考情報) </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-ml-pipelines">Azure Machine Learning パイプラインとは</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-pipelines#publish-a-pipeline">パイプラインを発行する</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-create-scheduled-function">Azure でタイマーによってトリガーされる関数を作成する</a></li></ul><hr><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>本記事では、Visual Studio Code を使用して Azure Functions へデプロイを行います。事前に以下を満たしているかご確認ください。  </p><ul><li>Azure Machine Learning <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-workspace#create-a-workspace">ワークスペース リソースの作成</a></li><li>Azure Machine Learning ワークスペース リソースへの<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-setup-authentication#service-principal-authentication">サービス プリンシパル認証設定</a><br>(手順参考) 「<a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/manage-azureml-service/authentication-in-azureml/authentication-in-azureml.ipynb">Authentication in Azure Machine Learning</a>」 の Service Principal Authentication セクション  </li><li>Azure Machine Learning <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-workspace#create-a-workspace">ワークスペース リソースの作成</a></li><li><a href="https://code.visualstudio.com/">Visual Studio Code</a> のインストール</li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-develop-vs-code?tabs=csharp#install-the-azure-functions-extension">Azure Functions 拡張機能</a> のインストール</li></ul><hr><h2 id="設定手順"><a href="#設定手順" class="headerlink" title="設定手順"></a>設定手順</h2><h3 id="Azure-Functions-のリソースの作成"><a href="#Azure-Functions-のリソースの作成" class="headerlink" title="Azure Functions のリソースの作成"></a>Azure Functions のリソースの作成</h3><p>Azure ポータルより Function App リソースを作成します。設定項目は、後述の画像を参照ください。</p><p>(参考) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-create-first-azure-function">Azure Portal で初めての関数を作成する</a><br>(参考) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-create-first-function-vs-code?pivots=programming-language-python">クイック スタート:Visual Studio Code を使用して Azure で関数を作成する</a>  </p><ul><li><p>「基本」情報を設定します。<br>&amp;emsp;設定例:<br>&amp;emsp;&amp;emsp;リソース グループ：任意<br>&amp;emsp;&amp;emsp;関数アプリ名：任意<br>&amp;emsp;&amp;emsp;公開：コード<br>&amp;emsp;&amp;emsp;ランタイム スタック：Python<br>&amp;emsp;&amp;emsp;バージョン：3.8<br>&amp;emsp;&amp;emsp;地域：任意</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-resource-01.png" width=600px>  </li><li><p>「ホスティング」情報を設定します。<br>&amp;emsp;設定例:<br>&amp;emsp;&amp;emsp;ストレージ アカウント：既定値<br>&amp;emsp;&amp;emsp;オペレーティング システム：Linux<br>&amp;emsp;&amp;emsp;プランの種類：既定値</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-resource-02.png" width=600px></li></ul><h3 id="Azure-Functions-プロジェクトの作成"><a href="#Azure-Functions-プロジェクトの作成" class="headerlink" title="Azure Functions プロジェクトの作成"></a>Azure Functions プロジェクトの作成</h3><p>Visual Studio Code を起動し、新しいプロジェクトを作成します。</p><ul><li><p>「Create New Project」ボタンをクリックします。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-01.png" width=400px></li><li><p>作業用のローカル フォルダーを選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-02.png" width=700px></li><li><p>プログラミング言語を選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-03.png" width=800px></li><li><p>言語のバージョンを選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-04.png" width=800px></li><li><p>「Timer trigger」を選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-05.png" width=800px></li><li><p>Function App の名前を付けます。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-06.png" width=800px></li><li><p>実行間隔を表す NCRONTAB 式の値を入力します。後で変更可能なので既定のまま進めます。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-07.png" width=800px></li><li><p>「Add to workspace」を選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-08.png" width=800px></li></ul><h3 id="コード-ファイルの編集"><a href="#コード-ファイルの編集" class="headerlink" title="コード ファイルの編集"></a>コード ファイルの編集</h3><p>Azure Functions プロジェクトに含まれるコード ファイル (__init__.py、function.json、requirements.txt) を編集します。  </p><ul><li><p>__init__.py</p><ul><li>ServicePrincipalAuthentication 関数の &lt;Tenant_Id&gt;、&lt;Application_Id&gt;、&lt;Client_Secret_Value&gt; の設定は、下記サイトの [Service Principal Authentication] セクションを参照ください。<br>(参考サイト) <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/manage-azureml-service/authentication-in-azureml/authentication-in-azureml.ipynb">Authentication in Azure Machine Learning</a></li><li>&lt;Subscription_Id&gt;、&lt;ResourceGroup_Name&gt;、&lt;Workspace_Name&gt;、&lt;Pipeline_Id&gt; は、使用する Azure Machine Learning ワークスペース リソースおよびパイプラインの情報を入力ください。&lt;Experiment_Name&gt; はトリガーによって実行した場合の実験名になりますので、任意に指定下さい。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> azure.functions <span class="keyword">as</span> func</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> azureml.core.authentication <span class="keyword">import</span> ServicePrincipalAuthentication</span><br><span class="line"><span class="keyword">from</span> azureml.pipeline.core <span class="keyword">import</span> PublishedPipeline</span><br><span class="line"><span class="keyword">from</span> azureml.core <span class="keyword">import</span> Workspace</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">SVC_PR_PWD = <span class="string">&quot;&lt;Client_Secret_Value&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">mytimer: func.TimerRequest</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">    utc_timestamp = datetime.datetime.utcnow().replace(</span><br><span class="line">        tzinfo=datetime.timezone.utc).isoformat()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mytimer.past_due:</span><br><span class="line">        logging.info(<span class="string">&#x27;The timer is past due!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">&#x27;Python timer trigger function ran at %s&#x27;</span>, utc_timestamp)</span><br><span class="line">    </span><br><span class="line">    logging.info(<span class="string">&#x27;Service Principal Authentication&#x27;</span>)</span><br><span class="line">    svc_pr = ServicePrincipalAuthentication(</span><br><span class="line">        tenant_id=<span class="string">&quot;&lt;Tenant_Id&gt;&quot;</span>,</span><br><span class="line">        service_principal_id=<span class="string">&quot;&lt;Application_Id&gt;&quot;</span>,</span><br><span class="line">        service_principal_password=SVC_PR_PWD)</span><br><span class="line">  </span><br><span class="line">    logging.info(<span class="string">&#x27;Get Workspace&#x27;</span>)</span><br><span class="line">    ws = Workspace(subscription_id=<span class="string">&quot;&lt;Subscription_Id&gt;&quot;</span>,</span><br><span class="line">                    resource_group=<span class="string">&quot;&lt;ResourceGroup_Name&gt;&quot;</span>,</span><br><span class="line">                    workspace_name=<span class="string">&quot;&lt;Workspace_Name&gt;&quot;</span>,</span><br><span class="line">                    auth=svc_pr)</span><br><span class="line">    </span><br><span class="line">    logging.info(<span class="string">&#x27;Get Published Pipeline&#x27;</span>)</span><br><span class="line">    pipeline = PublishedPipeline.get(ws, <span class="built_in">id</span>=<span class="string">&#x27;&lt;Pipeline_Id&gt;&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    logging.info(<span class="string">&#x27;Run Published Pipeline&#x27;</span>)</span><br><span class="line">    pipeline_run = pipeline.submit(ws, <span class="string">&#x27;&lt;Experiment_Name&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">&#x27;Waiting result&#x27;</span>)</span><br><span class="line">    pipeline_run.wait_for_completion(show_output=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li><li><p>function.json<br>shchedule 部分を編集することで実行時刻を変更可能です。指定方法は以下のサイトが参考になります。</p><ul><li>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-timer?tabs=python#ncrontab-expressions">NCRONTAB 式</a></li><li>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-timer?tabs=python#ncrontab-examples">NCRONTAB の例</a></li><li>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-timer?tabs=python#ncrontab-time-zones">NCRONTAB タイム ゾーン</a></li></ul><p>なお、UTC 指定となりますので、JST で指定する場合には 9 時間を差し引いた時刻を指定ください。以下画像では、毎日 8:30:00 JST に実行する設定としています。  </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scriptFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;__init__.py&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bindings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mytimer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timerTrigger&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;schedule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0 30 23 * * *&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>requirements.txt<br>azureml-core、azureml-pipeline-core、requests を追加します。  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DO NOT include azure-functions-worker in this file</span></span><br><span class="line"><span class="comment"># The Python Worker is managed by Azure Functions platform</span></span><br><span class="line"><span class="comment"># Manually managing azure-functions-worker may cause unexpected issues</span></span><br><span class="line"></span><br><span class="line">azure-functions</span><br><span class="line">azureml-core</span><br><span class="line">azureml-pipeline-core</span><br><span class="line">requests</span><br></pre></td></tr></table></figure></li></ul><h3 id="プロジェクトのデプロイ"><a href="#プロジェクトのデプロイ" class="headerlink" title="プロジェクトのデプロイ"></a>プロジェクトのデプロイ</h3><p>Visual Studio Code より、Azure Functions プロジェクトのデプロイを行います。デプロイ後にコード ファイルの再編集した場合でも、再度デプロイを実行することで変更を反映することが可能です。  </p><ul><li><p>Azure アイコンをクリックして、Function App を右クリックして、「Deploy to Function App…」を選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-11.png" width=400px></li><li><p>サブスクリプションを選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-12.png" width=800px></li><li><p>デプロイ先の Function App リソースを選択します。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-13.png" width=800px></li><li><p>「Deploy」ボタンをクリックします。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-14.png" width=600px></li><li><p>デプロイが完了したら、画面右下に下記のメッセージが表示されます。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-15.png" width=600px></li></ul><br><hr><h2 id="動作確認"><a href="#動作確認" class="headerlink" title="動作確認"></a>動作確認</h2><p>Azure ポータルより、作成したタイマー トリガーが存在し、有効になっていることを確認します。  </p><ul><li><p>Function App の動作を確認します。デプロイ先の Function App リソースに移動して、「関数」ボタンをクリックします。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-16.png" width=200px></li><li><p>作成した Function の名前をクリックします。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-17.png" width=600px></li><li><p>「モニター」ボタンをクリックして、呼び出しのトレースを確認できます。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-18.png" width=600px></li><li><p>上記の「日付」項目をクリックしますと、ログを確認できます。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-19.png" width=600px></li><li><p>Machine Learning リソースの実験画面で、Function App の Timer Trigger にトリガーされたパイプラインの実行を確認できます。</p><img src="https://jpmlblog.github.io/images/AML-scheduled-pipeline/create-function-project-20.png" width=600px></li></ul><br><p>Azure Functions を使用してパイプラインを定期的に実行する手順は以上となります。</p><hr><p><code>変更履歴</code><br><code>2020/11/30 created by Chao</code><br><code>2021/11/30 modified by Mochizuki</code>  </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure Functions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>仮想ネットワーク (Vnet) 上で Azure Machine Learning を使用する方法について</title>
      <link href="/blog/2020/10/28/AML-use-behind-vnet/"/>
      <url>/blog/2020/10/28/AML-use-behind-vnet/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning を仮想ネットワーク環境で使用する場合に、参考となる情報を列記いたします。また、具体的な作成方法などを本記事にて紹介させていただきます。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-network-security-overview">仮想ネットワークの分離とプライバシーの概要</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-secure-workspace-vnet">仮想ネットワークを使用して Azure Machine Learning ワークスペースをセキュリティで保護する</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-enable-studio-virtual-network">Azure 仮想ネットワークで Azure Machine Learning Studio を使用する</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-configure-private-link?tabs=azure-resource-manager">Azure Machine Learning ワークスペース用に Azure Private Link を構成する</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-create-workspace-template?wt.mc_id=ignite2020_presentations&tabs=azpowershell#deploy-workspace-behind-a-virtual-network">仮想ネットワークの背後にワークスペースをデプロイする</a></li></ul><span id="more"></span><br><hr><h2 id="構築方法について"><a href="#構築方法について" class="headerlink" title="構築方法について"></a>構築方法について</h2><p>ここでは新しく仮想ネットワークを作成し、その配下に各リソースを作成する手順を紹介します。主に以下サイトの手順に従っております。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-create-workspace-template?wt.mc_id=ignite2020_presentations&tabs=azpowershell#deploy-workspace-behind-a-virtual-network">仮想ネットワークの背後にワークスペースをデプロイする</a></li></ul><p>まずは各リソースを作成するリソース グループを作成します。なんらかのリソースの作成に失敗した際に、残存リソースの削除を簡単にするため、新たにリソース グループを作成することをおススメします。リソース基本パラメータおよび実行コマンドは以下の通りです。  </p><table><thead><tr><th align="left">項目</th><th align="left">パラメータ</th></tr></thead><tbody><tr><td align="left">リージョン</td><td align="left"><code>eastus</code> (米国東部)</td></tr><tr><td align="left">リソースグル―プ</td><td align="left"><code>amlvnetrg</code></td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-AzResourceGroup</span> <span class="literal">-Name</span> amlvnetrg <span class="literal">-Location</span> eastus</span><br></pre></td></tr></table></figure><p>次に、以下のような構成で各リソースを作成します。指定可能なパラメータは、テンプレート ファイル 「<a href="https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-machine-learning-advanced/azuredeploy.json">201-machine-learning-advanced&#x2F;azuredeploy.json</a>」 より参照頂けます。それぞれ用途に応じてカスタイマイズください。  </p><table><thead><tr><th align="left">項目</th><th align="left">パラメータ</th><th align="left">仮想ネットワーク化</th></tr></thead><tbody><tr><td align="left">リージョン</td><td align="left"><code>eastus</code> (米国東部)</td><td align="left">-</td></tr><tr><td align="left">リソースグル―プ</td><td align="left"><code>amlvnetrg</code></td><td align="left">-</td></tr><tr><td align="left">仮想ネットワーク</td><td align="left"><code>amlvnet</code></td><td align="left">-</td></tr><tr><td align="left">サブネットワーク</td><td align="left"><code>amlvsubnet</code></td><td align="left">-</td></tr><tr><td align="left">ワークスペース</td><td align="left"><code>amlvnetworkspace</code></td><td align="left">Private Link</td></tr><tr><td align="left">ストレージ アカウント</td><td align="left"><code>amlvnetstorage</code></td><td align="left">Vnet</td></tr><tr><td align="left">Key Vault</td><td align="left"><code>amlvnetkeyvault</code></td><td align="left">Vnet</td></tr><tr><td align="left">Application Insights</td><td align="left"><code>amlvnetappinsights</code></td><td align="left">- (未サポート)</td></tr><tr><td align="left">Container Registry</td><td align="left"><code>amlvnetconreg</code></td><td align="left">- (クォータ拡張要)</td></tr></tbody></table><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-AzResourceGroupDeployment</span> `</span><br><span class="line">  <span class="literal">-Name</span> <span class="string">&quot;amlvnetdeployment&quot;</span> `</span><br><span class="line">  <span class="literal">-ResourceGroupName</span> <span class="string">&quot;amlvnetrg&quot;</span> `</span><br><span class="line">  <span class="literal">-TemplateUri</span> <span class="string">&quot;https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/201-machine-learning-advanced/azuredeploy.json&quot;</span> `</span><br><span class="line">  <span class="literal">-location</span> <span class="string">&quot;eastus&quot;</span> `</span><br><span class="line">  <span class="literal">-vnetOption</span> <span class="string">&quot;new&quot;</span> `</span><br><span class="line">  <span class="literal">-vnetName</span> <span class="string">&quot;amlvnet&quot;</span> `</span><br><span class="line">  <span class="literal">-subnetName</span> <span class="string">&quot;amlvsubnet&quot;</span> `</span><br><span class="line">  <span class="literal">-privateEndpointType</span> <span class="string">&quot;AutoApproval&quot;</span> `</span><br><span class="line">  <span class="literal">-workspaceName</span> <span class="string">&quot;amlvnetworkspace&quot;</span> `</span><br><span class="line">  <span class="literal">-storageAccountBehindVNet</span> <span class="string">&quot;true&quot;</span> `</span><br><span class="line">  <span class="literal">-storageAccountName</span> <span class="string">&quot;amlvnetstorage&quot;</span> `</span><br><span class="line">  <span class="literal">-keyVaultName</span> <span class="string">&quot;amlvnetkeyvault&quot;</span> `</span><br><span class="line">  <span class="literal">-keyVaultBehindVNet</span> <span class="string">&quot;true&quot;</span> `</span><br><span class="line">  <span class="literal">-applicationInsightsName</span> <span class="string">&quot;amlvnetappinsights&quot;</span> `</span><br><span class="line">  <span class="literal">-containerRegistryName</span> <span class="string">&quot;amlvnetconreg&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意点 1 :<br>Key Vault リソースは一度削除してから同名で作り直すと soft-delete のエラーが発生します。これは、<a href="https://docs.microsoft.com/ja-jp/azure/key-vault/general/soft-delete-overview">Key Vault の論理的な削除</a>が働いているためです。「<a href="https://docs.microsoft.com/ja-jp/azure/key-vault/general/key-vault-recovery?tabs=azure-portal#list-recover-or-purge-a-soft-deleted-key-vault">論理的に削除されたキー コンテナーを一覧表示、回復、または消去する</a>」 の手順により、完全に削除することが可能です。 </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">New-AzResourceGroupDeployment</span> : xx:xx:xx - Resource Microsoft.KeyVault/vaults <span class="string">&#x27;amlvnetkeyvault&#x27;</span> failed with message <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">  &quot;error&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;code&quot;: &quot;ConflictError&quot;,</span></span><br><span class="line"><span class="string">    &quot;message&quot;: &quot;Exist soft deleted vault with the same name. &quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>注意点 2 :<br>10&#x2F;28 現在、Application Insights は仮想ネットワーク背後へのデプロイをサポートしていません。</p></blockquote><blockquote><p>注意点 3 :<br>Container Registry を仮想ネットワーク背後にデプロイする場合、幾つか<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-secure-workspace-vnet#enable-azure-container-registry-acr">条件</a>があります。使用したい場合、まず 「<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-manage-quotas#private-endpoint-and-private-dns-quota-increases">プライベート エンドポイントとプライベート DNS クォータの引き上げ</a>」 に従って、クォータ要求の引き上げをご依頼ください。  </p><blockquote><p>次のシナリオでは、場合によっては Microsoft が所有するサブスクリプションでクォータの割り当てを依頼する必要があります。</p><ul><li>カスタマーマネージド キー (CMK) を使用する Private Link 対応ワークスペース</li><li>仮想ネットワークの背後にあるワークスペースの Azure Container Registry</li><li>Private Link 対応の Azure Kubernetes Service クラスターのワークスペースへのアタッチ 。</li></ul></blockquote><p>クォータ引き上げ後、上述のコマンドの最後の部分を以下の通り変更することで仮想ネットワーク背後へのデプロイを実行することが可能です。  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-containerRegistryName</span> <span class="string">&quot;amlvnetconreg&quot;</span> `</span><br><span class="line"><span class="literal">-containerRegistryBehindVNet</span> <span class="string">&quot;true&quot;</span> `</span><br><span class="line"><span class="literal">-containerRegistryOption</span> <span class="string">&quot;new&quot;</span> `</span><br><span class="line"><span class="literal">-containerRegistrySku</span> <span class="string">&quot;Premium&quot;</span></span><br></pre></td></tr></table></figure><p>Container Registry を含めて仮想ネットワーク背後への配置した状態は、下記イメージのような状態となります。詳細は 「<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-network-security-overview#secure-the-workspace-and-associated-resources">ワークスペースと関連するリソースをセキュリティで保護する</a>」 を参照ください。    </p><p><img src="https://docs.microsoft.com/ja-jp/azure/machine-learning/media/how-to-network-security-overview/secure-workspace-resources.png" width=500px align="left" border="1"><br clear="left"></p></blockquote><hr><h2 id="利用上の留意点"><a href="#利用上の留意点" class="headerlink" title="利用上の留意点"></a>利用上の留意点</h2><p>ワークスペースの Private Link を有効化することで、パブリック インターネット経由のアクセスが制限され、仮想ネットワーク上のリソースからのみアクセスが可能になります。また、Mozilla Firefox を使用した場合には別の問題も報告されておりますので、Microsoft Edge または Google Chrome のご利用をお勧めいたします。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-configure-private-link?tabs=python">Azure Machine Learning ワークスペース用に Azure Private Link を構成する</a><blockquote><p>重要<br>Azure Private Link は、ワークスペースの削除やコンピューティング リソースの管理などの Azure コントロール プレーン (管理操作) には影響しません。 たとえば、コンピューティング先の作成、更新、削除などです。 これらの操作は、通常どおりパブリック インターネット経由で実行されます。 Azure Machine Learning Studio を使用するなどのデータ プレーン操作、API (公開されたパイプラインを含む)、または SDK では、プライベート エンドポイントが使用されます。  </p><p>Mozilla Firefox を使用している場合、ワークスペースのプライベート エンドポイントにアクセスしようとしたときに問題が発生することがあります。 この問題は、Mozilla の DNS over HTTPS に関連している可能性があります。 回避策として、Microsoft Edge または Google Chrome を使用することをお勧めします。</p></blockquote></li></ul><p>パブリック インターネット経由でアクセスした際に表示されるエラーメッセージを以下に紹介します。  </p><h3 id="Studio-アクセスが失敗する場合"><a href="#Studio-アクセスが失敗する場合" class="headerlink" title="Studio アクセスが失敗する場合"></a>Studio アクセスが失敗する場合</h3><p><img src="https://jpmlblog.github.io/images/AML-use-behind-vnet/AML-Studio-error.png" width=400px align="left" border="1"><br clear="left"> </p><p>NSG を使用してインターネット接続を制限している場合、仮想ネットワーク上のリソースからであっても Azure Machine Learning Studio へのアクセスが出来ない場合があります。下記サイトに記載されております通り、AzureFrontDoor.Frontend のサービス タグ宛の通信を許可する必要がある点についてご留意ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-enable-studio-virtual-network#access-the-studio-from-a-resource-inside-the-vnet">Azure 仮想ネットワークで Azure Machine Learning Studio を使用する #VNet 内のリソースから Studio にアクセスする</a>  <blockquote><p>仮想ネットワーク内のリソース (コンピューティング インスタンスや仮想マシンなど) からスタジオにアクセスする場合は、仮想ネットワークからスタジオへの送信トラフィックを許可する必要があります。  </p><p>たとえば、ネットワーク セキュリティ グループ (NSG) を使用して送信トラフィックを制限している場合は、 AzureFrontDoor.Frontend の サービス タグ 宛先に規則を追加します。</p></blockquote></li></ul><h3 id="Home-メニュー-アクセス時のエラー"><a href="#Home-メニュー-アクセス時のエラー" class="headerlink" title="Home メニュー アクセス時のエラー"></a>Home メニュー アクセス時のエラー</h3><p><img src="https://jpmlblog.github.io/images/AML-use-behind-vnet/AML-Home-menu-error.png" width=700px align="left" border="1"><br clear="left">  </p><blockquote><p>REQUEST_SEND_ERROR: Your request for data wasn’t sent. Here are some things to try: Check your network and internet connection, make sure a proxy server is not blocking your connection, follow our guidelines if you’re using a private link, and check if you have AdBlock turned on.</p></blockquote><h3 id="Notebooks-メニュー-アクセス時のエラー"><a href="#Notebooks-メニュー-アクセス時のエラー" class="headerlink" title="Notebooks メニュー アクセス時のエラー"></a>Notebooks メニュー アクセス時のエラー</h3><p><img src="https://jpmlblog.github.io/images/AML-use-behind-vnet/AML-Notebooks-menu-error.png" width=700px align="left" border="1"><br clear="left">  </p><blockquote><p>403: You are not authorized to access this resource. You are not authorized to access this resource.</p></blockquote><blockquote><p>Request authorization to storage account failed. Storage account might be behind a VNET. Please go to the Compute tab, create a compute instance, and launch Jupyter or Jupyter Lab to use your files and notebooks.</p></blockquote><h3 id="Compute-メニュー-アクセス時のエラー"><a href="#Compute-メニュー-アクセス時のエラー" class="headerlink" title="Compute メニュー アクセス時のエラー"></a>Compute メニュー アクセス時のエラー</h3><p><img src="https://jpmlblog.github.io/images/AML-use-behind-vnet/AML-Compute-menu-error.png" width=700px align="left" border="1"><br clear="left">  </p><blockquote><p>403: You are not authorized to access this resource. You are not authorized to access this resource.</p></blockquote><p>エラーは出力されますが、各コンピューティング リソースの作成、起動、停止、削除などの操作は可能です。必要に応じて、以下サイトを参考にロールベースでのアクセス制御 (RBAC) を実装いただくことをお勧めいたします。  </p><p>なお、Vnet に配置した Compute Instance のアプリケーション URI (Jupyter および Jupyter Lab のリンク) へのアクセスも、以下のメッセージが表示され失敗します。  </p><blockquote><p>User &lt;User Name&gt; does not have access to compute instance &lt;Compute Instance Name&gt;.</p><p>Only the creator can access a compute instance.</p></blockquote><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-assign-roles">Azure Machine Learning ワークスペースへのアクセスの管理</a></li></ul><h3 id="カスタム-DNS-サーバーを使用している場合"><a href="#カスタム-DNS-サーバーを使用している場合" class="headerlink" title="カスタム DNS サーバーを使用している場合"></a>カスタム DNS サーバーを使用している場合</h3><p>仮想ネットワークにカスタム DNS サーバーを設定している場合、DNS 名前解決にプライベート IP アドレスが返されず、アクセスに失敗する可能性があります。下記の情報に従い必要な設定をご検討ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-custom-dns?tabs=azure-portal">カスタム DNS サーバーでワークスペースを使用する方法</a></li></ul><h3 id="ExpressRoute-や-Azure-VPN-経由でアクセスする場合"><a href="#ExpressRoute-や-Azure-VPN-経由でアクセスする場合" class="headerlink" title="ExpressRoute や Azure VPN 経由でアクセスする場合"></a>ExpressRoute や Azure VPN 経由でアクセスする場合</h3><p>オンプレミスのマシンから ExpressRoute や Azure VPN 経由でワークスペースにアクセスする場合、名前解決で参照先 DNS サーバーの設定に依存してパブリック IP アドレスが返却されてしまい、アクセスが失敗する可能性があります。上述のカスタム DNS サーバーの設定をオンプレミスの DNS サーバーを対象に実施いただくことをご検討ください。</p><h3 id="Compute-Instance-作成時の留意点"><a href="#Compute-Instance-作成時の留意点" class="headerlink" title="Compute Instance 作成時の留意点"></a>Compute Instance 作成時の留意点</h3><p>ワークスペースで Private Link を有効にしている場合、Compute Instance および Compute Cluster は仮想ネットワーク上にしか作成できなくなります。この時、Compute Instance を作成すると仮想ネットワーク リソースのあるリソース グループ配下に、Load Balancer、Public IP Address、Network Security Group が作成されます。これらのリソースは Compute Instance に紐づいて作成されるため、別リソース グループに移動したり、作成時点で別のリソース グループを指定できない仕様になっております。  </p><p>リソース グループ単位での管理を行う必要がある場合、仮想ネットワークを Azure Machine Learning ワークスペースと同じリソース グループに作成いただく必要がございますこと、予めご留意願います。  </p><blockquote><p><font color="#FF0000">当該仕様変更リクエストを下記フィードバック サイトにて投稿しております。投票数が多いものから追加を検討される傾向にありますので、必要に応じてご投票およびコメントの追加にご協力いただけますと幸いです。</font>  </p><ul><li><a href="https://feedback.azure.com/forums/257792-machine-learning/suggestions/43181112-change-resource-group-for-lb-public-ip-and-nsg-o">Change resource group for LB, Public IP, and NSG of Compute Instance</a></li></ul></blockquote><br>※ 順次追加予定です。<hr><p><code>変更履歴</code><br><code>2020/10/28 created by Mochizuki</code><br><code>2020/11/05 modified by Mochizuki</code><br><code>2021/04/19 modified by Mochizuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 仮想ネットワーク </tag>
            
            <tag> Private Link </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning の名前付け規則について</title>
      <link href="/blog/2020/10/19/AML-dataset-name/"/>
      <url>/blog/2020/10/19/AML-dataset-name/</url>
      
        <content type="html"><![CDATA[<p>データセットの名前に漢字などの全角文字を使用した場合、登録後に Azure Machine Learning スタジオから参照できなくなる事象が報告されています。Azure Machine Learning の利用における名前付け規則などを踏まえ、現在確認されている事象について紹介いたします。  </p><span id="more"></span><br><hr><h2 id="名前付け規則について"><a href="#名前付け規則について" class="headerlink" title="名前付け規則について"></a>名前付け規則について</h2><p>Azure Machine Learning で使用するリソースの名前付け規則として、下記公開情報をのとおり、ワークスペースのリソースと、これを作成するリソース グループに名前付けの規則がございます。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/management/resource-name-rules#microsoftmachinelearningservices">Azure リソースの名前付け規則と制限事項 #Microsoft.MachineLearningServices</a><blockquote><table><thead><tr><th align="left">Entity</th><th align="left">Scope</th><th align="left">長さ</th><th align="left">有効な文字</th></tr></thead><tbody><tr><td align="left">workspaces&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">resource group&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">3-33&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">英数字とハイフン&amp;nbsp;&amp;nbsp;&amp;nbsp;</td></tr><tr><td align="left">workspaces &#x2F; computes&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">ワークスペース</td><td align="left">2-16&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">英数字とハイフン&amp;nbsp;&amp;nbsp;&amp;nbsp;</td></tr></tbody></table></blockquote></li></ul><p>また、Azure Machine Learning スタジオ上でコンピューティング リソースを作成する場合には、下記画像のように有効な文字の情報が表示され、名前の検証が行われますので、これに従い名前を指定下さい。  </p><p><img src="https://jpmlblog.github.io/images/AML-dataset-name/naming-rule-of-compute-instance.png" width=700px align="left"><br clear="left"></p><ul><li><p>エラー例 1.<br><img src="https://jpmlblog.github.io/images/AML-dataset-name/naming-error1-compute-instance.png" width=600px align="left"><br clear="left"></p></li><li><p>エラー例 2.<br><img src="https://jpmlblog.github.io/images/AML-dataset-name/naming-error2-compute-instance.png" width=600px align="left"><br clear="left"></p></li><li><p>エラー例 3.<br><img src="https://jpmlblog.github.io/images/AML-dataset-name/naming-error3-compute-instance.png" width=600px align="left"><br clear="left"></p></li></ul><hr><h3 id="データセットの名前付けで発生する事象について"><a href="#データセットの名前付けで発生する事象について" class="headerlink" title="データセットの名前付けで発生する事象について"></a>データセットの名前付けで発生する事象について</h3><p>データセットを登録する際に指定する名前には、上述のような公開情報や、機械的な名前検証が行われません。しかしながら、UTF-8 の 1 バイト コード以外の文字 (漢字などの全角文字や異なる言語の文字) を使用した場合、登録後に Azure Machine Learning スタジオで参照できなくなるといった現象が報告されています。  </p><p>例えば、下記の通り全角の “Ｄａｔａｓｅｔ” という名前で登録するとします。  </p><p><img src="https://jpmlblog.github.io/images/AML-dataset-name/name-of-dataset.png" width=800px align="left"><br clear="left"></p><p>これをクリックすると、以下の通り HTTP 404 エラーが表示されます。  </p><p><img src="https://jpmlblog.github.io/images/AML-dataset-name/name-of-dataset-error.png" width=400px align="left"><br clear="left"></p><p><img src="https://jpmlblog.github.io/images/AML-dataset-name/name-of-dataset-error-detail.png" width=350px align="left"><br clear="left"></p><hr><h3 id="対処方法について"><a href="#対処方法について" class="headerlink" title="対処方法について"></a>対処方法について</h3><p>このデータセットを Azure Machine Learning スタジオ上で登録解除しようとしても、正常に処理が進まず失敗します。この事象は、現在 (2020&#x2F;10&#x2F;19) 弊社開発部門にフィードバックを行い調査中となります。  </p><p>回避策として、Azure Machine Learning の CLI 拡張機能をすることでこれを登録解除することが出来ます。下記公開情報に従い、拡張機能のインストールおよびデータセットの登録解除をお試しください。  </p><ul><li><p><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/reference-azure-machine-learning-cli">Azure Machine Learning の CLI 拡張機能のインストールと使用</a>  </p><p>実行例:<br>Azure CLI がインストール済みの環境では以下の実行します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">az extension add -n azure-cli-ml</span><br><span class="line">az extension update -n azure-cli-ml</span><br></pre></td></tr></table></figure><p>初回アクセス時には、以下のコマンドでワークスペースにアタッチします。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az ml folder attach -w &quot;ワークスペース名&quot; -g &quot;リソース グル―プ名&quot;</span><br></pre></td></tr></table></figure><p>以下のコマンドでデータセットの登録を解除します。  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">az ml dataset unregister -n &quot;データセット名&quot;</span><br></pre></td></tr></table></figure></li></ul><hr><p><code>変更履歴</code><br><code>2020/10/19 created by Mochiszuki</code></p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 名前付け規則 </tag>
            
            <tag> Dataset </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning サービス宛の通信を許可する設定について</title>
      <link href="/blog/2020/10/10/AML-network-allow-settings/"/>
      <url>/blog/2020/10/10/AML-network-allow-settings/</url>
      
        <content type="html"><![CDATA[<p>オンプレミスの環境から Azure Machine Learning のサービスを利用する際、外部ネットワーク宛の通信をファイアウォールやプロキシ サーバー等によって制御している場合に、許可すべきホスト名等の情報をご紹介します。  </p><span id="more"></span><br><hr><h2 id="ホスト名ベースの許可"><a href="#ホスト名ベースの許可" class="headerlink" title="ホスト名ベースの許可"></a>ホスト名ベースの許可</h2><p>Azure Machine Learning で使用する通信先ホスト名の一覧は以下サイトに一覧化されております。これらのホスト名宛の送信方向の通信を許可するよう設定ください。(2022&#x2F;1&#x2F;13 時点)  </p><ul><li><p><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-access-azureml-behind-firewall#microsoft-hosts">ネットワークの着信トラフィックおよび送信トラフィックを構成する - # Microsoft のホスト</a></p><p>※ &lt;storage&gt; を、使用している Azure Machine Learning ワークスペースの既定のストレージ アカウント名に置き換えてください。</p></li></ul><p>Python パッケージをインストールして使用する要件がある場合、下記のようなホスト名宛の通信を許可する必要があります。なお、下記はインターネット上のすべての Python リソースに必要なホストの完全な一覧ではなく、最も一般的に使用されているもののみを取り上げています。たとえば、GitHub リポジトリまたはその他のホストにアクセスする必要がある場合は、そのシナリオに必要なホストを特定して追加する必要があることをご留意ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-access-azureml-behind-firewall#python-hosts">ネットワークの着信トラフィックおよび送信トラフィックを構成する - # Python のホスト</a></li></ul><p>R パッケージをインストールして使用する要件がある場合、下記のようなホスト名宛の通信を許可する必要があります。こちらも、必要なホストの完全な一覧ではない点についてご留意ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-access-azureml-behind-firewall#r-hosts">ネットワークの着信トラフィックおよび送信トラフィックを構成する - # R のホスト</a></li></ul><hr><h2 id="WebSocket-の考慮"><a href="#WebSocket-の考慮" class="headerlink" title="WebSocket の考慮"></a>WebSocket の考慮</h2><p>ネットワーク機器などで WebSocket の通信をブロックしている場合、上述したホスト名一覧について許可いただくことをお勧めいたします。<br>以下のホスト名について WebSocket の通信を許可するよう設定ください。  </p><p><del>*.azureml.ms</del> (2021&#x2F;6&#x2F;17 削除)<br><del>*.notebooks.azure.net</del> (2021&#x2F;6&#x2F;17 削除)<br><del>*.experiments.azureml.net</del>  (2022&#x2F;1&#x2F;13 削除)<br>*.instances.azureml.net<br>*.instances.azureml.ms  </p><p>今後サービス側機能の変更によって別のホスト名で WebSocket 通信を必須とする場合がございますので、その際には適宜許可を追加頂くことをご検討ください。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-secure-training-vnet#compute-clusters--instances">(参考情報) コンピューティング クラスターとインスタンス</a>  <blockquote><p>コンピューティング インスタンスの Jupyter 機能を動作させるには、Web ソケット通信が無効になっていないことを確認してください。 お使いのネットワークで、*.instances.azureml.net と *.instances.azureml.ms への websocket 接続が許可されていることを確認してください。</p></blockquote></li></ul><hr><h2 id="IP-アドレスの範囲指定で許可する場合"><a href="#IP-アドレスの範囲指定で許可する場合" class="headerlink" title="IP アドレスの範囲指定で許可する場合"></a>IP アドレスの範囲指定で許可する場合</h2><p>下記サイトに紹介されている IP アドレス一覧を使用して許可する方法につきましては、以下サイトの機能をご利用いただける可能性がございます。実装方法などの確認が必要な場合、 Azure Network 観点にてお問い合わせください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/virtual-network/service-tags-overview#service-tags-on-premises">オンプレミスのサービス タグ</a></li></ul><hr><p><code>変更履歴</code><br><code>2020/10/10 created by Mochizuki</code><br><code>2021/06/17 modified by Mochizuki</code><br><code>2021/07/13 modified by Mochizuki</code><br><code>2022/01/13 modified by Uehara</code><br><code>2022/08/02 modified by Mochizuki</code>  </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ファイアウォール </tag>
            
            <tag> プロキシ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Functions を使用してコンピューティング インスタンスを自動停止する方法について</title>
      <link href="/blog/2020/09/24/AML-functions-autostop/"/>
      <url>/blog/2020/09/24/AML-functions-autostop/</url>
      
        <content type="html"><![CDATA[<p>Azure Functions のタイマー トリガーを使用して、Azure Machine Learning のコンピューティング インスタンスを自動停止する方法を紹介します。</p><span id="more"></span><br><hr><p>Azure Machine Learning のコンピューティング インスタンスは、一度起動すると停止操作を行わない限り起動し続けます。起動時間に比例して仮想マシンの課金が発生しますので、停止忘れてしまった時の料金が思いのほか大きいこともあります。  </p><p>本記事では、Azure Functions のタイマー トリガーを使用して、Azure Machine Learning SDK (AzureML SDK) のコードを決まった時刻に実行させることで、コンピューティング インスタンスを自動停止させる方法を紹介します。  </p><p>(補足)<br>Azure Automation は Azure Machine Learning CLI および Python 3 (Preview 段階) の実行をサポートしていないため、本記事では触れておりません。  </p><p>(参考情報)</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/developer/python/tutorial-vs-code-serverless-python-01">チュートリアル:Visual Studio Code を使用して Python でサーバーレスの Azure Functions を作成してデプロイする</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-create-scheduled-function">Azure でタイマーによってトリガーされる関数を作成する</a></li></ul><hr><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p>本記事では、Visual Studio Code を使用して Azure Functions へデプロイを行います。事前に以下を満たしているかご確認ください。  </p><ul><li>Azure Machine Learning <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-workspace#create-a-workspace">ワークスペース リソースの作成</a></li><li>Azure Machine Learning ワークスペース リソースへの<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-setup-authentication#service-principal-authentication">サービス プリンシパル認証設定</a><br>(手順参考) 「<a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/manage-azureml-service/authentication-in-azureml/authentication-in-azureml.ipynb">Authentication in Azure Machine Learning</a>」 の Service Principal Authentication セクション  </li><li><a href="https://code.visualstudio.com/">Visual Studio Code</a> のインストール</li><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-develop-vs-code?tabs=csharp#install-the-azure-functions-extension">Azure Functions 拡張機能</a> のインストール</li></ul><hr><h2 id="設定手順"><a href="#設定手順" class="headerlink" title="設定手順"></a>設定手順</h2><h3 id="Azure-Functions-のリソースの作成"><a href="#Azure-Functions-のリソースの作成" class="headerlink" title="Azure Functions のリソースの作成"></a>Azure Functions のリソースの作成</h3><p>Azure ポータルより Function App リソースを作成します。設定項目は、後述の画像を参照ください。Visual Studio Code からも作成可能ですが、リソース グループの指定ができないため、本手順では Azure ポータルを使用します。</p><p>(参考) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-create-first-azure-function">Azure Portal で初めての関数を作成する</a><br>(参考) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-create-first-function-vs-code?pivots=programming-language-python">クイック スタート:Visual Studio Code を使用して Azure で関数を作成する</a>  </p><p>設定例:</p><ul><li>リソース グループ名: ※ 任意、本手順では functionsrg </li><li>関数アプリ名: ※ 任意、本手順では aml-managecompute  </li><li>公開: コード  </li><li>ランタイム スタック: Python  </li><li>バージョン: 3.6  </li><li>地域: ※ 任意、本手順では Japan East を選択</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-functions-resource-1.png" width=600px>  <p>設定例:</p><ul><li>Strage: ※ 既定のまま使用 </li><li>オペレーティング システム: Linux</li><li>プランの種類: 消費量 (サーバーレス)</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-functions-resource-2.png" width=600px>  <br><h3 id="Azure-Functions-プロジェクトの作成"><a href="#Azure-Functions-プロジェクトの作成" class="headerlink" title="Azure Functions プロジェクトの作成"></a>Azure Functions プロジェクトの作成</h3><p>Visual Studio Code を起動し、新しいプロジェクトを作成します。</p><ul><li>アクティビティ バーの Azure アイコンを選択、 [Functions] 領域で [Create New Project (新しいプロジェクトの作成)] アイコンを選択します。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-1.png" width=400px>  <ul><li>「Select the folder that will contain your function project (関数プロジェクトを含めるフォルダを選択してください)」 では Browse を選択し、Functions 専用のフォルダーを指定します。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-2.png" width=400px>  <ul><li>「Select a language for your function project (関数プロジェクトの言語を選択してください)」 では [Python] を選択します。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-3.png" width=400px>  <ul><li>「Select a Python alias to create a virtual environment (仮想環境を作成する Python エイリアスを選択してください)」 では Python インタープリターの場所を選択します。<br>場所 (以下画像の py 3.7.5 のようなパス) が表示されない場合、[Skip virtual environment] を選択ください。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-4.png" width=400px>  <ul><li>「Select a template for your project’s first function (プロジェクトの最初の関数のテンプレートを選択してください)」 では [Timer trigger] を選択します。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-5.png" width=400px>  <ul><li>「Provide a function name (関数名を指定してください)」 では任意の名前を指定します。<br>本手順では既定値 [TimerTrigger1] を使用します。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-6.png" width=400px>  <ul><li>「Enter a cron expression … (cron 式を入力してください)」 では、自動停止を実行したい時刻を指定します。<br>後から変更可能なので、既定値のままスキップください。</li></ul><img src="https://jpmlblog.github.io/images/AML-functions-autostop/create-new-project-7.png" width=400px>  <h3 id="コード-ファイルの編集"><a href="#コード-ファイルの編集" class="headerlink" title="コード ファイルの編集"></a>コード ファイルの編集</h3><p>Azure Functions プロジェクトに含まれるコード ファイル (__init__.py、function.json、requirements.txt) を編集します。  </p><ul><li><p>__init__.py</p><ul><li>ServicePrincipalAuthentication 関数の &lt;Tenant ID&gt;、&lt;Client ID&gt;、&lt;Client Secret&gt; の設定は、下記サイトの [Service Principal Authentication] セクションを参照ください。<br>(参考サイト) <a href="https://github.com/Azure/MachineLearningNotebooks/blob/master/how-to-use-azureml/manage-azureml-service/authentication-in-azureml/authentication-in-azureml.ipynb">Authentication in Azure Machine Learning</a></li><li>&lt;Workspace Name&gt;、&lt;Subscription ID&gt;、&lt;Resource Group Name&gt; は、ご利用の Azure Machine Learning ワークスペース リソースの情報を入力ください。</li><li>停止したいコンピューティング インスタンス名を指定する場合、&lt;Compute Instance Name&gt; に停止したいコンピューティング インスタンス名を指定した配列 compute_name を定義します。  </li><li>「type(computes[c]) &#x3D;&#x3D; ComputeInstance」 部分の “ComputeInstance” を “AmlCompute” に変更することでコンピューティング クラスターを指定することも可能です。<br>(参考サイト) <a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.compute?view=azure-ml-py#classes">compute Package</a></li><li>コンピューティング インスタンスの停止処理は、下記サイトの ComputeInstance クラスの stop 関数を使用します。起動させる場合には、state が “Stopped” という条件で、start 関数を実行するようにします。<br>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/python/api/azureml-core/azureml.core.compute.computeinstance.computeinstance?view=azure-ml-py">ComputeInstance class</a>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> azure.functions <span class="keyword">as</span> func</span><br><span class="line"><span class="keyword">from</span> azureml.core.workspace <span class="keyword">import</span> Workspace</span><br><span class="line"><span class="keyword">from</span> azureml.core.compute <span class="keyword">import</span> ComputeTarget, ComputeInstance</span><br><span class="line"><span class="keyword">from</span> azureml.core.compute_target <span class="keyword">import</span> ComputeTargetException</span><br><span class="line"><span class="keyword">from</span> azureml.core.authentication <span class="keyword">import</span> ServicePrincipalAuthentication</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">mytimer: func.TimerRequest</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># サービス プリンシパル認証の設定</span></span><br><span class="line">    svc_pr = ServicePrincipalAuthentication(</span><br><span class="line">            tenant_id=<span class="string">&quot;&lt;Tenant ID&gt;&quot;</span>,</span><br><span class="line">            service_principal_id=<span class="string">&quot;&lt;Client ID&gt;&quot;</span>,</span><br><span class="line">            service_principal_password=<span class="string">&quot;&lt;Client Secret&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ワークスペース情報の取得</span></span><br><span class="line">    ws = Workspace.get(name=<span class="string">&quot;&lt;Workspace Name&gt;&quot;</span>,</span><br><span class="line">            subscription_id=<span class="string">&quot;&lt;Subscription ID&gt;&quot;</span>,</span><br><span class="line">            resource_group=<span class="string">&quot;&lt;Resource Group Name&gt;&quot;</span>,</span><br><span class="line">            auth=svc_pr)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ワークスペース内の全てのコンピューティング インスタンス名の取得</span></span><br><span class="line">    computes = ws.compute_targets</span><br><span class="line">    compute_name = [c <span class="keyword">for</span> c <span class="keyword">in</span> computes <span class="keyword">if</span> <span class="built_in">type</span>(computes[c]) == ComputeInstance]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 停止したいコンピューティング インスタンス名を指定する場合</span></span><br><span class="line">    <span class="comment"># compute_name = [&quot;&lt;Compute Instance Name&gt;&quot;, &quot;&lt;Compute Instance Name&gt;&quot;, ...]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Running 状態のコンピューティング インスタンスを停止実行</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> compute_name:</span><br><span class="line">        state = ComputeInstance(ws, i).get_status().state</span><br><span class="line">        <span class="keyword">if</span> state == <span class="string">&quot;Running&quot;</span>:</span><br><span class="line">            ComputeInstance(ws, i).stop(wait_for_completion=<span class="literal">False</span>, show_output=<span class="literal">False</span>)</span><br><span class="line">            logging.info(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span> state is <span class="subst">&#123;state&#125;</span> now. The auto-stop process is executed.&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logging.info(<span class="string">f&quot;<span class="subst">&#123;i&#125;</span> state is <span class="subst">&#123;state&#125;</span> now. The auto-stop process is NOT executed.&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul></li><li><p>function.json<br>shchedule 部分を編集することで実行時刻を変更可能です。指定方法は以下のサイトが参考になります。</p><ul><li>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-timer?tabs=python#ncrontab-expressions">NCRONTAB 式</a></li><li>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-timer?tabs=python#ncrontab-examples">NCRONTAB の例</a></li><li>(参考サイト) <a href="https://docs.microsoft.com/ja-jp/azure/azure-functions/functions-bindings-timer?tabs=python#ncrontab-time-zones">NCRONTAB タイム ゾーン</a></li></ul><p>なお、UTC 指定となりますので、JST で指定する場合には 9 時間を差し引いた時刻を指定ください。以下画像では、毎日 21:25:00 JST に起動する設定としています。  </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scriptFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;__init__.py&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;bindings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mytimer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;timerTrigger&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;direction&quot;</span><span class="punctuation">:</span> <span class="string">&quot;in&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;schedule&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0 25 12 * * *&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>requirements.txt<br>azureml-core を追加します。  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DO NOT include azure-functions-worker in this file</span></span><br><span class="line"><span class="comment"># The Python Worker is managed by Azure Functions platform</span></span><br><span class="line"><span class="comment"># Manually managing azure-functions-worker may cause unexpected issues</span></span><br><span class="line"></span><br><span class="line">azure-functions</span><br><span class="line">azureml-core</span><br></pre></td></tr></table></figure></li></ul><h3 id="プロジェクトのデプロイ"><a href="#プロジェクトのデプロイ" class="headerlink" title="プロジェクトのデプロイ"></a>プロジェクトのデプロイ</h3><p>Visual Studio Code より、Azure Functions プロジェクトのデプロイを行います。デプロイ後にコード ファイルの再編集した場合でも、再度デプロイを実行することで変更を反映することが可能です。  </p><ul><li><p>Visual Studio Code の [Functions] 領域より作成した Azure Functions リソースを右クリックし、[Deploy to Function App…] を選択します。  </p><img src="https://jpmlblog.github.io/images/AML-functions-autostop/deploy-functions-project-1.png" width=400px>  </li><li><p>「Select the folder to deploy」 では Browse を選択し、Functions 専用のフォルダーを指定します。  </p><img src="https://jpmlblog.github.io/images/AML-functions-autostop/deploy-functions-project-2.png" width=400px>  </li><li><p>上書き確認の警告メッセージがポップアップしますので、[Deploy] を選択して続行します。</p><img src="https://jpmlblog.github.io/images/AML-functions-autostop/deploy-functions-project-3.png" width=400px></li></ul><hr><h2 id="動作確認"><a href="#動作確認" class="headerlink" title="動作確認"></a>動作確認</h2><p>Azure ポータルより、作成した Function App リソースの [関数] メニューを表示し、タイマー トリガーが存在し、有効になっていることを確認します。  </p><img src="https://jpmlblog.github.io/images/AML-functions-autostop/confirmation-funcapp-1.png" width=700px>  <p>タイマー トリガーのリンクをクリックすると、デプロイした設定や動作履歴を確認することが可能です。下記画像は、[モニター] メニューより 12:24:59 UTC (-&gt; 概ね 21:25:00 JST) にトリガーが実行されていることが確認できます。  </p><img src="https://jpmlblog.github.io/images/AML-functions-autostop/confirmation-funcapp-2.png" width=850px>  <br><hr><h2 id="参考-AzureML-CLI-を使用する場合"><a href="#参考-AzureML-CLI-を使用する場合" class="headerlink" title="(参考) AzureML CLI を使用する場合"></a>(参考) AzureML CLI を使用する場合</h2><p>Azure Machine Learning CLI (AzureML CLI) は Azure CLI への拡張機能です。下記サイトに具体的な使用方法が紹介されております。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/reference-azure-machine-learning-cli">Azure Machine Learning の CLI 拡張機能のインストールと使用</a></li></ul><p>関連するコマンドは以下サイトより確認可能です。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/cli/azure/ext/azure-cli-ml/ml/computetarget/computeinstance?view=azure-cli-latest">az ml computetarget computeinstance</a></li></ul><p>本記事では時刻実行する方法については言及せず、コンピューティング インスタンスの起動停止に関連する操作部分のみ抜粋して以下に紹介します。  </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Azure サブスクリプションへの CLI の接続  </span></span><br><span class="line">az login  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 拡張機能のインストール  </span></span><br><span class="line">az extension add <span class="literal">-n</span> azure<span class="literal">-cli-ml</span>  </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 拡張機能の更新  </span></span><br><span class="line">az extension update <span class="literal">-n</span> azure<span class="literal">-cli-ml</span>  </span><br><span class="line"> </span><br><span class="line"><span class="comment"># ワークスペースへの接続  </span></span><br><span class="line">az ml folder attach <span class="literal">-w</span> &lt;ワークスペース名&gt; <span class="literal">-g</span> &lt;リソース グル―プ名&gt;  </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Compute Instance の起動  </span></span><br><span class="line">az ml computetarget computeinstance <span class="built_in">start</span> <span class="literal">-n</span> &lt;コンピューティング インスタンス名&gt;  </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Compute Instance の停止  </span></span><br><span class="line">az ml computetarget computeinstance stop <span class="literal">-n</span> &lt;コンピューティング インスタンス名&gt;  </span><br></pre></td></tr></table></figure><hr><p><code>変更履歴</code><br><code>2020/09/24 created by Mochizuki</code><br><code>2020/09/28 modified by Mochizuki</code>  </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure Functions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning におけるネットワーク関連エラー発生時の情報採取について</title>
      <link href="/blog/2020/08/31/Collectinfo_AzureConnection/"/>
      <url>/blog/2020/08/31/Collectinfo_AzureConnection/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning サービスのご利用時に、HTTP ステータス コードなどネットワーク関連のエラーが表示される場合があります。問題の調査にはネットワーク関連の情報が必要となります。以下に、汎用的な情報採取手順を紹介します。  </p><span id="more"></span><br><hr><h2 id="対象"><a href="#対象" class="headerlink" title="対象"></a>対象</h2><p>事象の再現が可能な端末 (OS: Windows 10 の各バージョン)</p><h2 id="事前準備"><a href="#事前準備" class="headerlink" title="事前準備"></a>事前準備</h2><p><a href="https://jpmlblog.github.io//files/CollectInfo_AzureConnection.txt" title="CollectInfo_AzureConnection.txt">こちら</a> から CollectInfo_AzureConnection.txt ファイルをダウンロードします。ローカルに保存後、拡張子を .txt から .bat に変更し、任意の場所に移します。  </p><p><font color="#FF0000">※ ダウンロード時に拡張子を .bat に変更して保存すると、ダウンロード自体がブロックされる可能性があります。<br>　 ローカルに保存後に拡張子を変更ください。<br></font></p><p>&lt;実施対象に以下が存在する状態&gt;<br>・ [任意の場所]\CollectInfo_AzureConnection.bat ファイル</p><h2 id="影響"><a href="#影響" class="headerlink" title="影響"></a>影響</h2><p>ログを採取することで負荷が上がる可能性は考えられますが、基本的に OS リソースや処理への影響はありません。 </p><h2 id="実行手順"><a href="#実行手順" class="headerlink" title="実行手順"></a>実行手順</h2><p>(1) 再現確認用マシンに管理者アカウントでログオンします。<br>(2) CollectInfo_AzureConnection.bat ファイルを右クリックし、[管理者として実行] を選択します。  </p><p><font color="#FF0000">※ 実行時、Microsoft Defender SmartScreen によって実行確認のメッセージが表示される可能性があります。<br>　 [詳細情報] をクリックいただくと実行ボタンが表示されますので、[実行] を選択ください。<br></font></p><p>(3) “Please enter the number you want to execute. Enter q to quit tool.” メッセージに <code>1</code> を入力、リターン キーを押下し、表示に従いメニューに戻ります。  </p><p>※ CollectInfo_AzureConnection.bat のコマンド プロンプトは起動したままにしておきます。  </p><p>(4) Microsoft Edge (Chromium) または Chrome を起動し、問題が再現する操作の直前まで画面を進めます。  </p><p>※ (5) ～ (11) の手順は 「<a href="https://docs.microsoft.com/ja-jp/azure/azure-portal/capture-browser-trace">トラブルシューティングのためにブラウザー トレースをキャプチャする</a>」 の内容を参考にしています。上記以外のブラウザーを使用する場合、こちらのサイトを参考に実行ください。  </p><p>(5) F12 キーを押下し、デベロッパー ツールを起動します。<br>(6) [Network]タブを選択し、[Preserve log] を選択します。  </p><p><img src="https://docs.microsoft.com/ja-jp/azure/azure-portal/media/capture-browser-trace/chromium-network-preserve-log.png" alt="chromium-network-preserve-log.png">  </p><p>(7) [Console] タブを選択し、[Console settings] を選択してから、[Preserve Log] を選択します。[Console settings] をもう一度選択して、設定ペインを閉じます。  </p><p><img src="https://docs.microsoft.com/ja-jp/azure/azure-portal/media/capture-browser-trace/chromium-console-preserve-log.png" alt="chromium-console-preserve-log.png">  </p><p>(8) [Network] タブを選択し、 [Stop recording network log] と [Clear] を選択します。  </p><p><img src="https://docs.microsoft.com/ja-jp/azure/azure-portal/media/capture-browser-trace/chromium-stop-clear-session.png" alt="chromium-stop-clear-session.png">  </p><p>(9) [Record network log] を選択して、問題を再現します。  </p><p><img src="https://docs.microsoft.com/ja-jp/azure/azure-portal/media/capture-browser-trace/chromium-start-session.png" alt="chromium-start-session.png">  </p><p>※ 事象の再現を確認、そのまま十数秒ほど待ちます。  </p><p>(10) [Stop recording network log] を選択し、 [Export HAR] を選択して任意の場所に .har ファイルを保存します。  </p><p><img src="https://docs.microsoft.com/ja-jp/azure/azure-portal/media/capture-browser-trace/chromium-network-export-har.png" alt="chromium-network-export-har.png">  </p><p>(11) <a href="%E3%82%B3%E3%83%B3%E3%82%BD%E3%83%BC%E3%83%AB">Console</a> タブを選択します。いずれかのメッセージを右クリックし、 [Save as…] を選択して、任意の場所に .log ファイルを保存します。  </p><p><img src="https://docs.microsoft.com/ja-jp/azure/azure-portal/media/capture-browser-trace/chromium-console-select.png" alt="chromium-console-select.png">  </p><p>※ 以下、CollectInfo_AzureConnection.bat のコマンド プロンプトにて再度操作を実施します。  </p><p>(12) “Please enter the number you want to execute. Enter q to quit tool.” メッセージに <code>2</code> を入力、リターン キーを押下し、表示に従いメニューに戻ります。<br>(13) “Please enter the number you want to execute. Enter q to quit tool.” メッセージに <code>3</code> を入力、リターン キーを押下し、表示に従いメニューに戻ります。<br>(14) “Please enter the number you want to execute. Enter q to quit tool.” メッセージに <code>q</code> を入力、リターン キーを押下してツールを終了します。<br>(15) 手順 (10) および (11) で保存したファイル (拡張子 .har および .log のファイル) と、デスクトップ上 <code>&lt;YYYYMMDD 形式の年月日&gt;_&lt;ホスト名&gt;_info</code> フォルダーをまとめて ZIP 圧縮し、お問い合わせいただく際にご提供ください。  </p><p>※ サポート リクエストに関する参考情報<br>・ <a href="https://docs.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-create-azure-support-request">Azure サポート要求を作成する</a><br>・ <a href="https://azure.microsoft.com/ja-jp/support/create-ticket/">サポート チケットの作成</a></p><hr><p>本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。  </p><p><code>変更履歴</code><br><code>2020/08/31 created by Mochizuki</code></p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 情報採取手順 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning ワークスペースの作成が Internet Explorer 11 で失敗する</title>
      <link href="/blog/2020/08/31/AML-IE11/"/>
      <url>/blog/2020/08/31/AML-IE11/</url>
      
        <content type="html"><![CDATA[<p>Internet Explorer 11 (IE11) 利用時に発生する現象について紹介します。</p><span id="more"></span><br><hr><h2 id="IE11-関連事例について"><a href="#IE11-関連事例について" class="headerlink" title="IE11 関連事例について"></a>IE11 関連事例について</h2><p>Azure ポータルで Azure Machine Learning ワークスペースの作成が失敗するといった報告が複数件寄せられております。この事象は、Azure ポータルを Internet Explorer 11 で開いてリソース作成を行った場合に発生することが確認できております。  </p><div style="text-align: center;">(再現時、下記表示のまま状態が遷移しません)<img src="https://jpmlblog.github.io/images/AML-IE11/Create-workspace-error.png" width=600px></div>    <p>また、Azure Machine Learning ポータル (<a href="https://ml.azure.com/">https://ml.azure.com/</a>) の操作においても予期しないエラーが発生するといった報告もございます。これらの事象は、別のブラウザ (Microsoft Edge または Chrome) を使用することで回避できる可能性があります。  </p><p>Internet Explorer 11 は弊社サービスに限らず幅広い Web サービスで、順次サポート対象外になる予定です。恐れ入りますが、現段階で Microsoft Edge などへの移行をご検討ください。   </p><ul><li><a href="https://blogs.windows.com/japan/2020/08/18/microsoft-365-apps-say-farewell-to-internet-explorer-11/">Microsoft 365 アプリの Internet Explorer 11 のサポート終了と Windows 10 での Microsoft Edge レガシー版のサービス終了</a></li></ul><hr><h2 id="その他のブラウザーの事例について"><a href="#その他のブラウザーの事例について" class="headerlink" title="その他のブラウザーの事例について"></a>その他のブラウザーの事例について</h2><p>Mozilla Firefox を使用する環境において、ワークスペースのプライベート エンドポイントにアクセスしようとしたときに問題が発生するといった報告がございます。この問題は、Mozilla の DNS over HTTPS に関連している可能性があり、Microsoft Edge および Chrome のご利用をお勧めしております。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-configure-private-link?tabs=python">Azure Machine Learning ワークスペース用に Azure Private Link を構成する</a><blockquote><p>Mozilla Firefox を使用している場合、ワークスペースのプライベート エンドポイントにアクセスしようとしたときに問題が発生することがあります。 この問題は、Mozilla の DNS over HTTPS に関連している可能性があります。 回避策として、Microsoft Edge または Google Chrome を使用することをお勧めします。</p></blockquote></li></ul><p>また、Microsoft Edge および Chrome のご利用環境においても、Azure Machine Learning ポータルの一部のメニューが表示されなかったり、機能の実行が失敗するなどといった事象が報告されています。こうした事象は古いバージョンのブラウザーを使用していることに起因している可能性があるため、原因の切り分けとして以下の切り分けの実施をご検討ください。  </p><ul><li>ブラウザーを最新バージョンにアップデートする</li></ul><hr><p><code>変更履歴</code><br><code>2020-08-31 created by Mochizuki</code></p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Internet Explorer 11 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning Studio でモデル登録およびデプロイする場合の留意点について</title>
      <link href="/blog/2020/08/25/AML-register-and-deploy-model/"/>
      <url>/blog/2020/08/25/AML-register-and-deploy-model/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning Studio でモデル登録する場合の留意点についてお纏めします。</p><span id="more"></span><br><hr><p>Azure Machine Learning Studio (<a href="https://ml.azure.com/">https://ml.azure.com/</a>) のユーザー インターフェイスでは、モデル登録およびデプロイを行うことができます。この時、設定方法が誤っているとモデルのデプロイ操作が長時間完了せず、結果として登録が失敗する場合があります。  </p><p>本記事では、具体的な例を挙げて手順を詳細させていただきます。  </p><hr><h2 id="モデルの登録"><a href="#モデルの登録" class="headerlink" title="モデルの登録"></a>モデルの登録</h2><p>Azure Machine Learning Studio (<a href="https://ml.azure.com/">https://ml.azure.com/</a>) の [アセット] - [モデル] の [+ モデルの登録] をクリックします。  </p><img src="https://jpmlblog.github.io/images/AML-register-and-deploy-model/Register-model-button.png" width=500px>  <p>表示された入力項目のうち、* マークのある項目を全て埋めて [登録] ボタンをクリックします。  </p><img src="https://jpmlblog.github.io/images/AML-register-and-deploy-model/Register-model-config.png" width=400px>  <p>この時、以下の点に留意ください。</p><ul><li>モデル フレームワークを誤って選択するとデプロイに失敗します。不明な場合には、[その他] を選択し、フレーム ワーク名、バージョンは空欄にします。指定するとデプロイが簡略化されますが、指定しなくても登録可能です。<br> (参考情報) <a href="https://docs.microsoft.com/ja-jp/python/api/azureml-core/azureml.core.model(class)?view=azure-ml-py">Model class</a>  <blockquote><p>The framework of the registered model. Using the system-supported constants from the Framework class allows for simplified deployment for some popular frameworks.</p></blockquote></li></ul><hr><h2 id="モデルのデプロイ"><a href="#モデルのデプロイ" class="headerlink" title="モデルのデプロイ"></a>モデルのデプロイ</h2><p>Azure Machine Learning Studio (<a href="https://ml.azure.com/">https://ml.azure.com/</a>) の [アセット] - [モデル] より、登録されているモデルをクリックします。  </p><img src="https://jpmlblog.github.io/images/AML-register-and-deploy-model/Deploy-model-button.png" width=500px>  <p>表示された入力項目のうち、* マークのある項目を全て埋めて [登録] ボタンをクリックします。  </p><img src="https://jpmlblog.github.io/images/AML-register-and-deploy-model/Deploy-model-config.png" width=400px>  <p>この時、以下の点に留意ください。  </p><ul><li><p>エントリ スクリプト ファイルおよび Conda 依存関係ファイルは下記サイトを参考にご準備ください。<br> (参考情報) <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-and-where?tabs=python#define-an-entry-script">エントリ スクリプトを定義する</a><br> (参考情報) <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-and-where?tabs=python#define-an-inference-configuration">推論構成を定義する</a>  </p></li><li><p>エントリ スクリプト ファイルのモデル指定に誤りがあったり、Conda 依存関係ファイルが誤っていると、デプロイ操作がエラーの表示なく長時間完了しない場合があります。デプロイ先のリソースにエラーが記録されている場合がありますので、厳密な調査が必要となりましたら、モデルファイル、エントリ スクリプト ファイル、Conda 依存関係ファイルと共にサポート リクエストを発行ください。</p></li></ul><p><b><u>(参考) 自動 ML (Automated Machine Learning) のモデルのデプロイ</b></u><br>自動 ML の実行結果からモデルをデプロイする場合、エントリ スクリプト ファイルおよび Conda 依存関係ファイルを指定する必要はありません。具体的な操作内容は下記サイトを参照ください。<br>(参考情報) <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-use-automated-ml-for-ml-models#deploy-your-model">モデルをデプロイする</a></p><hr><p><code>変更履歴</code><br><code>2020/08/25 created by Mochizuki</code>  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> モデル登録 </tag>
            
            <tag> デプロイ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>モデルを仮想ネットワーク上の Azure Container Instances (ACI) にデプロイする方法について</title>
      <link href="/blog/2020/08/18/AML-deploy-aci-vnet/"/>
      <url>/blog/2020/08/18/AML-deploy-aci-vnet/</url>
      
        <content type="html"><![CDATA[<p>モデルを仮想ネットワーク上の ACI にデプロイする方法について紹介します。  </p><p>Azure Machine Learning に仮想ネットワーク (Azure Virtual Network: VNET) を使用することで、機械学習のライフサイクルをセキュリティで保護することが可能になります。例えば、ACI を仮想ネットワークに置くことで、Web エンドポイントをパブリック インターネットから保護することができます。  </p><span id="more"></span><br><hr><p>Azure Machine Learning を使用して Azure Container Instances (ACI) にモデルを Web サービスとしてデプロイする方法は、以下の公開情報が参考になります。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-azure-container-instance">CLI (v1) を使用して Azure Container Instances にモデルをデプロイする</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-troubleshoot-deployment?tabs=azcli">リモートでのモデル デプロイのトラブルシューティング</a></li></ul><p>仮想ネットワーク上の ACI にモデルをデプロイする場合、Azure Machine Learning ワークスペースにプライベート エンドポイント接続があるとサポートされなくなりました。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-secure-inferencing-vnet?tabs=python#azure-container-instances">仮想ネットワークを使用して Azure Machine Learning 推論環境をセキュリティで保護する #Azure Container Instances</a></li></ul><hr><h2 id="仮想ネットワークの作成例"><a href="#仮想ネットワークの作成例" class="headerlink" title="仮想ネットワークの作成例"></a>仮想ネットワークの作成例</h2><p>新たに仮想ネットワークを作成する際には、以下<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-azure-container-instance#limitations">制限事項</a>  について予めご留意ください。  </p><blockquote><p>Azure Machine Learning ワークスペースがプライベート エンドポイントで構成されている場合、VNet でのAzure Container Instances へのデプロイはサポートされていません。 代わりに、ネットワークの分離とマネージド オンライン エンドポイントを使用することを検討してください。  </p></blockquote><p>「<a href="https://docs.microsoft.com/ja-jp/azure/virtual-network/manage-subnet-delegation#create-the-virtual-network">サブネットの委任を追加または削除する - 仮想ネットワークの作成</a>」 の手順に従って仮想ネットワークの作成を進めます。</p><ul><li><p>[基本] タブの設定例です。仮想ネットワークはワークスペースと同じリソースグループに作成します。同じリソースグル―プの既存の仮想ネットワークでも使用可能です。名前、地域は任意です。  </p> <img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-vnet1.png" width=600px>  </li><li><p>[IP アドレス] タブの設定例です。仮想ネットワークの IP アドレス帯は任意で変更可能です。サブネットはそのままで進めます。  </p> <img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-vnet2.png" width=600px></li></ul><p>[セキュリティ]、[タグ] タブも既定のまま進めると下記の画面に進みます。手順例では、リソースグループ amlrg に amlvnet1 という仮想ネットワークが作成されます。  </p>   <img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-vnet3.png" width=350px>  <br>  <hr><h2 id="サブネットの作成例"><a href="#サブネットの作成例" class="headerlink" title="サブネットの作成例"></a>サブネットの作成例</h2><p>作成した仮想ネットワークにサブネットを作成します。「<a href="https://docs.microsoft.com/ja-jp/azure/virtual-network/manage-subnet-delegation#delegate-a-subnet-to-an-azure-service">サブネットの委任を追加または削除する - サブネットを Azure サービスに委任する</a>」 の手順に従って進めます。  </p><ul><li><p>サブネットの作成例です。名前、アドレス範囲は任意です。サブネットの委任に <code>Microsoft.ContainerInstance/containerGroups</code> を指定します。  </p> <img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-subnet1.png" width=250px></li></ul><p>ここまで進めると、amlvnet1 配下に default と amlsubnet1 サブネットが存在し、amlsubnet1 には委任先に <code>Microsoft.ContainerInstance/containerGroups</code> が設定されていることが確認できます。  </p><img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-subnet2.png" width=750px>  <br><hr><h2 id="仮想ネットワークへのモデル-デプロイ例"><a href="#仮想ネットワークへのモデル-デプロイ例" class="headerlink" title="仮想ネットワークへのモデル デプロイ例"></a>仮想ネットワークへのモデル デプロイ例</h2><p>SDK を使用して作成する必要があります。<a href="https://docs.microsoft.com/ja-jp/python/api/azureml-core/azureml.core.webservice.aci.aciwebservice?view=azure-ml-py#deploy-configuration-cpu-cores-none--memory-gb-none--tags-none--properties-none--description-none--location-none--auth-enabled-none--ssl-enabled-none--enable-app-insights-none--ssl-cert-pem-file-none--ssl-key-pem-file-none--ssl-cname-none--dns-name-label-none--primary-key-none--secondary-key-none--collect-model-data-none--cmk-vault-base-url-none--cmk-key-name-none--cmk-key-version-none--vnet-name-none--subnet-name-none-">AciWebservice.deploy_configuration()</a> 関数の引数 vnet_name、subnet_name に作成した仮想ネットワークとサブネットを指定して deployment_config を作成し、<a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.model.model?view=azure-ml-py#deploy-workspace--name--models--inference-config-none--deployment-config-none--deployment-target-none--overwrite-false-">Model.deploy()</a> に指定して実行します。具体的な手順は以下を参照ください。  </p><ul><li><p><a href="https://docs.microsoft.com/en-us/python/api/azureml-core/azureml.core.model.model?view=azure-ml-py#deploy-workspace--name--models--inference-config-none--deployment-config-none--deployment-target-none--overwrite-false-">Model.deploy()</a> の実行には models や inference_config を事前に設定している必要があります。以下に、モデル ファイル model.pkl、Conda 依存関係ファイル myenv.yml、エントリ スクリプト ファイル score.py を基にして、それぞれ設定するコード スニペットを紹介します。    </p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> azureml.core <span class="keyword">import</span> Workspace</span><br><span class="line"><span class="keyword">from</span> azureml.core <span class="keyword">import</span> Environment</span><br><span class="line"><span class="keyword">from</span> azureml.core.model <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> azureml.core.model <span class="keyword">import</span> InferenceConfig</span><br><span class="line"></span><br><span class="line">ws = Workspace.from_config()</span><br><span class="line">model = Model.register(model_path=<span class="string">&quot;model.pkl&quot;</span>,</span><br><span class="line">                       model_name=<span class="string">&quot;mymodel&quot;</span>,</span><br><span class="line">                       workspace=ws)</span><br><span class="line">env = Environment.from_conda_specification(name=<span class="string">&#x27;myenv&#x27;</span>, file_path=<span class="string">&#x27;myenv.yml&#x27;</span>)</span><br><span class="line">inference_config = InferenceConfig(entry_script=<span class="string">&quot;score.py&quot;</span>, environment=env)</span><br></pre></td></tr></table></figure></li><li><p>「<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-azure-container-instance#using-the-sdk">Azure Container Instances にモデルをデプロイする - SDK を使用する</a>」 のコードに vnet_name、subnet_name を追加して実行します。以下にコード スニペットを紹介します。  </p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> azureml.core.webservice <span class="keyword">import</span> AciWebservice, Webservice</span><br><span class="line"><span class="keyword">from</span> azureml.core.model <span class="keyword">import</span> Model</span><br><span class="line"></span><br><span class="line">deployment_config = AciWebservice.deploy_configuration(cpu_cores = <span class="number">1</span>, memory_gb = <span class="number">1</span>,</span><br><span class="line">    vnet_name = <span class="string">&quot;amlvnet1&quot;</span>, subnet_name = <span class="string">&quot;amlsubnet1&quot;</span>)</span><br><span class="line">service = Model.deploy(ws, <span class="string">&quot;aciservice&quot;</span>, [model], inference_config, deployment_config)</span><br><span class="line">service.wait_for_deployment(show_output = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li></ul><p>作成された REST エンドポイントは、Azure Machine Learning ポータルの [エンドポイント] から確認できます。以下画像では REST エンドポイントは <code>http://10.0.1.4/score</code> となっています。  </p><img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-aci.png" width=600px>  <br><hr><h2 id="参考-Web-サービスの動作確認例"><a href="#参考-Web-サービスの動作確認例" class="headerlink" title="参考: Web サービスの動作確認例"></a>参考: Web サービスの動作確認例</h2><p>Web サービスと同じ仮想ネットワーク上にあるコンピュート インスタンスから Web リクエストを実行する方法を紹介します。まず、<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-enable-virtual-network#compute-clusters--instances">こちらのサイト</a> を参照し、ネットワーク セキュリティ グループ (NSG) を作成します。下記画像ではリージョンの指定を省略しています。  </p><img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-nsg.png" width=800px>  <p>作成した NSG を amlvnet1 の default サブネットに設定します。  </p><img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-change-nsg.png" width=500px>  <p>amlvnet1 の default サブネットに Compute Instance を作成します。  </p><img src="https://jpmlblog.github.io/images/AML-deploy-aci-vnet/AML-create-compute.png" width=500px>  <p>作成したコンピュート インスタンス上で以下のコードを実行します。<a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-consume-web-service#call-the-service-python">こちら</a> のサイトの手順が参考になります。  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">scoring_uri = <span class="string">&#x27;http://10.0.1.4/score&#x27;</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&quot;data&quot;</span>:</span><br><span class="line">       [[ *** モデルに併せてデータを設定ください *** ]]</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">input_data  = json.dumps(rawdata)</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">resp = requests.post(scoring_uri, input_data , headers=headers)</span><br><span class="line"><span class="built_in">print</span>(resp.text)</span><br></pre></td></tr></table></figure><br><hr><p><code>変更履歴</code><br><code>2020/08/18 created by Mochizuki</code><br><code>2022/03/16 created by Mochizuki</code><br><code>2022/06/21 created by Mochizuki</code>  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Azure Container Instances </tag>
            
            <tag> 仮想ネットワーク </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning のコスト見積もりについて</title>
      <link href="/blog/2020/06/18/AML-estimate-costs/"/>
      <url>/blog/2020/06/18/AML-estimate-costs/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning のコスト見積もりについて、参考となる情報を紹介します。</p><span id="more"></span><br><hr><p>本記事では具体的なコストの見積もり例を紹介します。<br>コストの管理に関する基本的な考え方は、下記サイトの内容を参照ください。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-plan-manage-cost">Azure Machine Learning のコストを計画して管理する</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-manage-optimize-cost">Azure Machine Learning のコストを管理して最適化する</a></li></ul><hr><h2 id="コスト見積もり例について"><a href="#コスト見積もり例について" class="headerlink" title="コスト見積もり例について"></a>コスト見積もり例について</h2><p>Azure Machine Learning のワークスペース自体には課金は発生しません。ワークスペースで作成したリソースに課金が発生します。  </p><p>例えば、開発環境として使用する Azure Machine Learning コンピューティング インスタンスや、トレーニングの実行環境として使用する Azure Machine Learning コンピューティング クラスターは、稼働時間分が課金対象となります。また、作成したモデルをデプロイした場合、デプロイ先のサービスについても比較的大きな課金が発生します。参考に見積もり例を後述に紹介します。  </p><p>※ ご利用方法によって試算より誤差が生じる場合がありますので、予めご留意ください。</p><h3 id="コンピューティング-インスタンス"><a href="#コンピューティング-インスタンス" class="headerlink" title="コンピューティング インスタンス"></a>コンピューティング インスタンス</h3><p>開発環境として Azure Machine Learning コンピューティング インスタンス (東日本リージョン、STANDARD_DS3_V2) を 1 日 10 時間起動し、30 日間使用する場合の月額  </p><p><font color="#FF0000"><strong>注意</strong><br>VM としての料金に加えて、下記 3 つのサービスに対して課金が発生いたします。これらの課金はコンピューティング インスタンスを停止していても継続されます。これらのサブ リソースが作成される理由については、”サブ リソースについて” セクションをご参照ください。  </p><p>例 (東日本リージョン):  </p><ul><li>スタンダード ロード バランサー (約 2.8 [円&#x2F;時間])  </li><li>スタンダード (静的) パブリック IP アドレス (約 0.56 [円&#x2F;時間])  </li><li>マネージド ディスク p10 (約 2,539.04 [円&#x2F;月]<br>※ 30 [日&#x2F;月] の場合、約 3.5264 [円&#x2F;時間], 31 [日&#x2F;月] の場合、約 3.4127 [円&#x2F;時間])</li></ul><p>参考: <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-create-manage-compute-instance?tabs=python#manage">Azure Machine Learning コンピューティング インスタンスを作成して管理する</a>  </p><blockquote><p> コンピューティング インスタンスを停止すると、コンピューティング時間の課金は停止しますが、ディスク、パブリック IP、および Standard Load Balancer に対しては引き続き課金されます。<br></font></p></blockquote><p>(VM)<br><code>45.808 [円/時間] x 10 [時間/日] x 30 [日] = 13742.4 [円]</code>  </p><p>(関連サービス ※ 30 [日&#x2F;月] の場合)<br><code>(2.8 + 0.56 + 3.5264 [円/時間]) x 24 [時間/日] x 30 [日] = 4958.208 [円]</code>  </p><p>→ 合計 <code>13742.4 + 4958.208 = 18700.608 [円]</code>  </p><ul><li>参考サイト<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-compute-target#supported-vm-series-and-sizes">サポートされている VM シリーズおよびサイズ</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/machine-learning/">Azure Machine Learning の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/load-balancer/">負荷分散 の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/ip-addresses/">IP アドレス の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/managed-disks/">Managed Disks の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/calculator/?service=machine-learning-service">料金計算ツール (+Azure Machine Learning)</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/virtual-machines/linux/">Linux Virtual Machines の料金</a></li></ul><h3 id="コンピューティング-クラスター"><a href="#コンピューティング-クラスター" class="headerlink" title="コンピューティング クラスター"></a>コンピューティング クラスター</h3><p>トレーニング ターゲットとして Azure Machine Learning コンピューティング クラスター (東日本リージョン、STANDARD_DS3_V2) を最小 0 ノード、最大 2 ノードで作成し、2 ノードで 1 日 4 時間、30 日間使用する場合の月額  </p><p><font color="#FF0000"><strong>注意:</strong><br>VM としての料金に加えて、下記 3 つのサービスに対して課金が発生いたします。環境情報を維持しないといけないコンピューティング インスタンスとは異なり、停止している場合 (起動しているノード数が 0 の場合) には割り当てが完全に解除されるため、課金は停止します。これらのサブ リソースが作成される理由については、”サブ リソースについて” セクションをご参照ください。    </p><p>例 (東日本リージョン):  </p><ul><li>スタンダード ロード バランサー (約 2.8 [円&#x2F;時間])  </li><li>スタンダード (静的) パブリック IP アドレス (約 0.56 [円&#x2F;時間])  </li><li>マネージド ディスク p10 (約 2,539.04 [円&#x2F;月]<br>※ 30 [日&#x2F;月] の場合、約 3.5264 [円&#x2F;時間], 31 [日&#x2F;月] の場合、約 3.4127 [円&#x2F;時間])</li></ul></font><p>(VM)<br><code>45.808 [円/時間/ノード] x 2 [ノード] x 4 [時間/日] x 30 [日] = 10993.92 [円]</code>  </p><p>(関連サービス ※ 30 [日&#x2F;月] の場合)<br><code>(2.8 + 0.56 + 3.5264 [円/時間]) x 4 [時間/日] x 30 [日] = 826.368 [円]</code>  </p><p>→ 合計 <code>10993.92 + 826.368 = 11820.288 [円]</code>  </p><ul><li>参考サイト<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-compute-target#supported-vm-series-and-sizes">サポートされている VM シリーズおよびサイズ</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/machine-learning/">Azure Machine Learning の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/batch/">Batch の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/load-balancer/">負荷分散 の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/ip-addresses/">IP アドレス の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/managed-disks/">Managed Disks の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/calculator/?service=machine-learning-service">料金計算ツール (+Azure Machine Learning)</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/virtual-machines/linux/">Linux Virtual Machines の料金</a></li></ul><h3 id="推論クラスター-Azure-Kubernetes-Service-AKS"><a href="#推論クラスター-Azure-Kubernetes-Service-AKS" class="headerlink" title="推論クラスター (Azure Kubernetes Service, AKS)"></a>推論クラスター (Azure Kubernetes Service, AKS)</h3><p>推論用クラスターとして Azure Kubernetes Service の仮想マシン (東日本リージョン、STANDARD_DS12_V2) を 3 ノードで作成し、30 日間使用する場合の月額  </p><blockquote><p>注意:<br>コア数合計を 12 以上で作成する必要があります。  </p></blockquote><p>→ <code>51.408 [円/時間/ノード] x 3 [ノード] x 24 [時間/日] x 30 [日] = 111041.28 [円]</code></p><ul><li>参考サイト<br><a href="https://azure.microsoft.com/ja-jp/pricing/details/kubernetes-service/">Azure Kubernetes Service (AKS) の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/calculator/?service=kubernetes-service">料金計算ツール (+Azure Kubernetes Service)</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/details/virtual-machines/linux/">Linux Virtual Machines の料金</a></li></ul><h3 id="Azure-Container-Instance-ACI"><a href="#Azure-Container-Instance-ACI" class="headerlink" title="Azure Container Instance (ACI)"></a>Azure Container Instance (ACI)</h3><p>モデルを Azure Container Instance (vCPU 1、メモリ 1 GiB) にデプロイし、30 日間使用する場合の月額  </p><blockquote><p>注意:<br>Azure Machine Learning で ACI にモデルをデプロイする場合、指定したコンテナーに加えて azureml-fe-aci (それぞれ vCPU 0.1、メモリ 0.5 GiB) が作成されます。また、vCPU は小数点第一位で切り上げされて計上されます。また、メモリは小数点第二位で切り上げされて計上されます。  </p></blockquote><p>(vCPU)<br><code>0.0015743 [円/秒/vCPU] x 2 [vCPU] x 3600 [秒/時間] x 24 [時間/日] = 272.03904 [円/日]</code><br><code>272.03904 [円/日] x 30 [日] = 8161.1712 [円]</code>  </p><p>(メモリ)<br><code>0.0001721 [円/秒/GiB] x 1.5 [Gib] x 3600 [秒/時間] x 24 [時間/日] = 22.30416 [円/日]</code><br><code>22.30416 [円/日] x 30 [日] = 669.1248 [円]</code>  </p><p>→ 合計 <code>8161.1712 + 669.1248 = 8830.296 [円]</code></p><ul><li>参考サイト<br><a href="https://azure.microsoft.com/ja-jp/pricing/details/container-instances/">Container Instances の価格</a><br><a href="https://azure.microsoft.com/ja-jp/pricing/calculator/?service=container-instances">料金計算ツール (+Container Instance)</a></li></ul><hr><h2 id="見積もりが難しいコストについて"><a href="#見積もりが難しいコストについて" class="headerlink" title="見積もりが難しいコストについて"></a>見積もりが難しいコストについて</h2><p>上記に加えて以下リソースの課金が発生いたします。これらはご利用方法によって金額が大きく異なりますため、試算を含めた見積もりを例示することができません。一般的に上述の料金と比較して数パーセント程度の小さい金額となりますため、一定期間ご利用いただいた後、実際の課金額を基に見積もることをお勧めします。  </p><ul><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/container-registry/">Azure Container Registry Basic アカウント</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/storage/blobs/">Azure ブロック BLOB Storage (汎用 v2)</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/key-vault/">Key Vault</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/monitor/">Application Insights</a></li></ul><p>また、ワークスペースやストレージ等を仮想ネットワークに配置する場合、パブリック エンドポイントやプライベート DNS ゾーン、ロード バランサーの料金が追加で発生いたします。固定でかかる費用となりますので、こちらも一定期間ご利用いただい後、実際の課金額を基に見積もることをお勧めします。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-network-security-overview">仮想ネットワークの分離とプライバシーの概要</a></li></ul><hr><h2 id="サブ-リソースについて"><a href="#サブ-リソースについて" class="headerlink" title="サブ リソースについて"></a>サブ リソースについて</h2><p>コンピューティング インスタンスおよびコンピューティング クラスターを作成すると、VM の料金に加えてネットワークに関連したリソースが併せて作成されます。これらは作成されたノードとの通信を維持するために使用され、課金の対象になります。  </p><p>参考: <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-workspace#sub-resources">サブ リソース</a></p><blockquote><p>これらのサブ リソースは、AML ワークスペースで作成される主要なリソースです。</p><ul><li>VM: AML ワークスペースのコンピューティング能力を提供します。モデルのデプロイとトレーニングに不可欠な要素です。</li><li>ロード バランサー: コンピューティング インスタンスおよびクラスターが停止している場合でもトラフィックを管理するために、コンピューティング インスタンスとコンピューティング クラスターごとにネットワーク ロード バランサーが作成されます。</li><li>仮想ネットワーク: これらは、Azure リソースが互いに通信したり、インターネットやその他のオンプレミス ネットワークと通信したりするために役立ちます。</li><li>帯域幅: リージョン間のすべてのアウトバウンド データ転送をカプセル化します。</li></ul></blockquote><p>参考: <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-plan-manage-cost#costs-might-accrue-before-resource-deletion">リソースの削除前にコストが発生する可能性がある</a></p><blockquote><p>Azure portal 内で、または Azure CLI を使用して Azure Machine Learning ワークスペースを削除する前、ワークスペース内でアクティブに作業していない場合でも、次のサブ リソースは一般的なコストとして蓄積されます。 後でご自身の Azure Machine Learning ワークスペースに戻る予定がある場合、これらのリソースには引き続きコストが発生する可能性があります。    </p><ul><li>VM  </li><li>Load Balancer  </li><li>Virtual Network  </li><li>帯域幅</li></ul><p>VM はそれぞれ、実行している時間ごとに課金されます。 コストは VM の仕様によって異なります。 実行中であっても、データセットに対してアクティブに動作していない VM については、ロード バランサー経由で課金されます。 コンピューティング インスタンスごとに、1 日あたり 1 つのロード バランサーに対して請求が発生します。 コンピューティング クラスターの 50 ノードごとに、1 つの Standard ロード バランサーが課金されます。 ロード バランサーあたりの課金額は 1 日あたり約 0.33 ドルです。 停止しているコンピューティング インスタンスとコンピューティング クラスターに対してロード バランサーのコストが発生するのを回避するには、コンピューティング リソースを削除します。 サブスクリプションごと、およびリージョンごとに 1 つの仮想ネットワークが課金されます。 仮想ネットワークは、複数のリージョンまたはサブスクリプションにまたがることはできません。 vNet 設定内でプライベート エンドポイントを設定しても、料金が発生することがあります。 帯域幅は使用量に基づいて課金されます。転送データが多いほど、料金は高くなります。</p></blockquote><hr><h2 id="ワークスペース削除"><a href="#ワークスペース削除" class="headerlink" title="ワークスペース削除"></a>ワークスペース削除</h2><p>Azure ポータルまたは Azure CLI で Azure Machine Learning ワークスペースを削除した後も、次のリソースは引き続き存在します。これらは削除されるまでコストが発生し続けます。  </p><ul><li>Azure Container Registry</li><li>Azure Storage Account</li><li>Key Vault</li><li>Application Insights</li></ul><p>これらのリソースと共にワークスペースを削除するには、SDK を使用します。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws.delete(delete_dependent_resources=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ワークスペースに Azure Kubernetes Service (AKS) を作成する場合、またはワークスペースにコンピューティング リソースをアタッチする場合は、Azure ポータルで個別に削除する必要があります。</p><ul><li>参考サイト<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-plan-manage-cost#costs-might-accrue-after-resource-deletion">リソースの削除後にコストが発生する可能性がある</a><br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-workspace#associated-resources">関連するリソース</a></li></ul><hr><h2 id="サービスの価格に関する問い合わせ"><a href="#サービスの価格に関する問い合わせ" class="headerlink" title="サービスの価格に関する問い合わせ"></a>サービスの価格に関する問い合わせ</h2><p>各サービスの価格に関するご質問 (Azure Machine Learning で発生する費用の内訳を知りたい、または発生したコストがどのリソースで消費しているか、など) は、弊社課金サポートで承っております。以下の画像を参考に、サポート リクエストを発行いただきお問い合わせください。  </p><p><img src="https://jpmlblog.github.io/images/AML-estimate-costs/support-request-for-billing.png" width=600px align="left"><br clear="left"></p><hr><h2 id="見積もりの依頼について"><a href="#見積もりの依頼について" class="headerlink" title="見積もりの依頼について"></a>見積もりの依頼について</h2><p>貴社ご利用方法における見積もりの回答が必要な場合、営業担当のタスクとして対応させていただいております。下記サイトを参考によりご依頼ください。  </p><ul><li><a href="https://azure.microsoft.com/ja-jp/pricing/contact-sales/">Azure 価格について 1 対 1 でのガイダンスを受ける</a></li><li><a href="https://azure.microsoft.com/ja-jp/overview/sales-number/">Azure 営業担当者に問い合わせる</a></li></ul><hr><p><code>変更履歴</code><br><code>2020/06/18 created by Mochizuki</code><br><code>2020/11/12 modified by Mochizuki</code><br><code>2020/11/18 modified by Mochizuki</code><br><code>2020/11/27 modified by Mochizuki</code><br><code>2021/05/26 modified by Mochizuki</code><br><code>2021/06/07 modified by Mochizuki</code><br><code>2021/07/20 modified by Mochizuki</code><br><code>2021/07/28 modified by Mochizuki</code><br><code>2021/10/15 modified by Mochizuki</code> </p><p>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 価格 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning Studio (Classic) ワークスペースを削除できない事象について</title>
      <link href="/blog/2020/06/09/AMLSC-cannot-delete/"/>
      <url>/blog/2020/06/09/AMLSC-cannot-delete/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learning Studio (Classic) のワークスペース削除後も、課金が継続していたり、ポータルからワークスペースにアクセスできてしまう場合の対処方法をご紹介します。  </p><span id="more"></span><br><hr><p>Azure ポータルから対象のリソースを削除した後、そのリソースで継続して課金が発生しているといったお問い合わせを頂くことがございます。この現象は、リソースの削除時の操作や Azure サービス側の不具合等に起因して発生いたします。  </p><p>Azure Machine Learning Studio (Classic) ワークスペース リソースにおいても、稀にこの現象が発生することが確認できています。例えば、削除したはずのワークスペースの課金が継続していたり、削除したワークスペースへのアクセスができてしまうといった現象が報告されています。  </p><p>現在、 Machine Learning Studio (Classic) については Azure ポータルからのリソース削除で、課金を含むワークスペースの情報が完全に削除されるようシステムの改修を検討中です。一方で上記のような事象が実際に発生した場合の対処としては、該当リソースの手動削除を弊社開発部門にリクエストする必要がありますので、以下の手順で情報を採取して弊社サポート窓口までお問い合わせください。</p><ul><li>(1) 課金が発生しているワークスペース ID &#x2F; リソース ID を確認  </li><li>(2) リソース削除を希望するサポート リクエストを発行</li></ul><p>それぞれ具体的な手順を後述にご紹介します。  </p><hr><div style="text-align: left;"><h3 id="1-ワークスペース-ID-x2F-リソース-ID-の確認手順"><a href="#1-ワークスペース-ID-x2F-リソース-ID-の確認手順" class="headerlink" title="(1) ワークスペース ID &#x2F; リソース ID の確認手順"></a>(1) ワークスペース ID &#x2F; リソース ID の確認手順</h3><p>課金対象になっているリソースの特定には、ワークスペース ID またはリソース ID が必要になります。どちらか一方の情報にて問題ございません。それぞれ確認方法は下記を参照ください。</p><ul><li><p>ワークスペース ID の確認方法</p><p> 「<a href="https://studio.azureml.net/Home">Azure Machine Learning Studio (Classic) ワークスペース</a>」 にアクセスし、[Settings] メニューよりワークスペース ID を確認します。  </p><p> <img src="https://jpmlblog.github.io/images/AMLSC-cannot-delete/workspace-id.png" alt="workspace-id.png">  </p></li><li><p>リソース ID の確認方法</p><p> 「<a href="https://docs.microsoft.com/ja-jp/azure/cost-management-billing/manage/download-azure-invoice-daily-usage-date">Azure の請求書と毎日の使用状況データをダウンロードまたは表示する</a>」 サイトの 「Azure 請求書 (.pdf) のダウンロード」 セクションの 4. の手順より csv ファイルをダウンロードし、ResourceId (ResourceId) の項目を確認します。  </p><p> <img src="https://jpmlblog.github.io/images/AMLSC-cannot-delete/download-invoice.png" alt="download-invoice.png">  </p><p> CSV ファイルの以下の列を確認ください。  </p><p> <img src="https://jpmlblog.github.io/images/AMLSC-cannot-delete/download-invoice-csv.png" alt="download-invoice-csv.png"></p></li></ul><hr><h3 id="2-リソース削除を希望するサポート-リクエストを発行"><a href="#2-リソース削除を希望するサポート-リクエストを発行" class="headerlink" title="(2) リソース削除を希望するサポート リクエストを発行"></a>(2) リソース削除を希望するサポート リクエストを発行</h3><p>「<a href="https://docs.microsoft.com/ja-jp/azure/azure-portal/supportability/how-to-create-azure-support-request">Azure サポート要求を作成する方法</a>」 サイトを参考にサポート リクエストを発行します。具体的な設定項目は下記を参照ください。これら以外はサポート リクエストの指示に従いご入力ください。</p><ul><li><p>[基本] タブの設定</p><p> 問題の種類やサービス、リソースなどはこちらを参考に設定します。  </p><p> <img src="https://jpmlblog.github.io/images/AMLSC-cannot-delete/support-request.png" alt="support-request.png"><br> ※ Azure ポータルの言語設定を English にしている場合には、サービスは [Machine Learning Studio] を選択ください。</p></li><li><p>[詳細] タブの設定</p><p> [詳細] タブの [* 詳細] 欄に、確認したワークスペース ID またはリソース ID を記載します。  </p><p> <img src="https://jpmlblog.github.io/images/AMLSC-cannot-delete/support-request-detail.png" alt="support-request-detail.png"></p></li></ul><br></div><p>上記内容が問題解消に向けた手助けとなりましたら幸いです。  </p><hr><p><code>変更履歴</code><br><code>2020/06/09 created by Mochizuki</code> </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning Studio (Classic) </category>
          
      </categories>
      
      
        <tags>
            
            <tag> リソース削除 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning の参考となる公開情報について</title>
      <link href="/blog/2020/04/22/reference-websites/"/>
      <url>/blog/2020/04/22/reference-websites/</url>
      
        <content type="html"><![CDATA[<p>Azure Machine Learninig のご利用にあたり、参考となる公開情報を紹介します。</p><span id="more"></span><br><hr><h2 id="Azure-Machine-Learning-関連サイト"><a href="#Azure-Machine-Learning-関連サイト" class="headerlink" title="Azure Machine Learning 関連サイト"></a>Azure Machine Learning 関連サイト</h2><p>Azure Machine Learning の技術ドキュメント、価格、更新情報など。専用ポータルは <a href="https://ml.azure.com/">こちら (https://ml.azure.com/)</a>。</p><ul><li><a href="https://azure.microsoft.com/ja-jp/services/machine-learning/">Azure Machine Learning (概要)</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/">Azure Machine Learning のドキュメント</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/algorithm-module-reference/module-reference">Azure Machine Learning デザイナーのアルゴリズムとモジュールのリファレンス</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/azure-machine-learning-release-notes">Azure Machine Learning のリリース ノート</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/machine-learning/">Azure Machine Learning の価格</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/updates/?product=machine-learning-service">Azure の更新情報 (?product&#x3D;machine-learning-service)</a></li></ul><p>過去の Q&amp;A、新規 Q&amp;A、機能改善のフィードバックなど。</p><ul><li><a href="https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureMachineLearningService">(旧) Q&amp;A</a>  </li><li><a href="https://docs.microsoft.com/en-us/answers/topics/azure-machine-learning.html">Q&amp;A</a>  </li><li><a href="https://feedback.azure.com/forums/257792-machine-learning">feedback forum</a>  </li><li><a href="https://stackoverflow.com/questions/tagged/azure-machine-learning-service">Stack Overflow</a></li></ul><hr><h2 id="Azure-Machine-Learning-Studio-Classic-関連サイト"><a href="#Azure-Machine-Learning-Studio-Classic-関連サイト" class="headerlink" title="Azure Machine Learning Studio (Classic) 関連サイト"></a>Azure Machine Learning Studio (Classic) 関連サイト</h2><p><font color="#FF0000"><strong>注意</strong><br>当該サービスは 2024 年 8 月 31 日に廃止されます。Azure Machine Learning への早めの移行をご計画ください。参考情報は <a href="https://azure.microsoft.com/en-us/updates/machine-learning-studio-classic-will-retire-on-31-august-2024/">こちら</a>。  </p></font>  <p>Azure Machine Learning Studio (Classic) の技術ドキュメント、価格、更新情報など。専用ポータルは <a href="https://studio.azureml.net/">こちら (https://studio.azureml.net/)</a>。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio/">Azure Machine Learning Studio (classic) のドキュメント</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio-module-reference/">Azure Machine Learning Studio (クラシック): アルゴリズムとモジュールのヘルプ</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/machine-learning-studio/">Machine Learning Studio の価格</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/updates/?product=machine-learning-studio">Azure の更新情報 (?product&#x3D;machine-learning-studio)</a></li></ul><p>過去の Q&amp;A、新規 Q&amp;A、機能改善のフィードバックなど。</p><ul><li><a href="https://social.msdn.microsoft.com/Forums/en-US/home?forum=MachineLearning">(旧) フォーラム サイト</a></li><li><a href="https://docs.microsoft.com/en-us/answers/topics/azure-machine-learning-studio-classic.html">フォーラム サイト</a></li><li><a href="https://feedback.azure.com/forums/257792-machine-learning">feedback forum</a>  </li><li><a href="https://stackoverflow.com/questions/tagged/azure-machine-learning-studio">Stack Overflow</a></li></ul><hr><h2 id="機械学習の前提知識習得向け参考サイト"><a href="#機械学習の前提知識習得向け参考サイト" class="headerlink" title="機械学習の前提知識習得向け参考サイト"></a>機械学習の前提知識習得向け参考サイト</h2><p>機械学習に関する概要情報、学習用のコンテンツなど。</p><ul><li><a href="https://azure.microsoft.com/ja-jp/overview/what-is-machine-learning-platform/">機械学習とは何ですか?</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/overview/machine-learning-algorithms/">機械学習アルゴリズム</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/learn/browse/?products=azure-machine-learning&resource_type=learning%20path">ラーニング パス (?products&#x3D;azure-machine-learning&amp;resource_type&#x3D;learning%20path)</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/learn/browse/?products=azure-machine-learning&subjects=data-ai&resource_type=module">ラーニング モジュール (?products&#x3D;azure-machine-learning&amp;subjects&#x3D;data-ai&amp;resource_type&#x3D;module)</a>  </li><li><a href="https://www.youtube.com/watch?v=xx-meKk03YY">とっても便利! Azure Machine Leaning</a>  </li><li>初心者向けデータ サイエンス解説ビデオ<blockquote><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio/data-science-for-beginners-the-5-questions-data-science-answers">データ サイエンスが回答する 5 つの質問</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio/data-science-for-beginners-is-your-data-ready-for-data-science">データ サイエンス用のデータの準備はお済みですか?</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio/data-science-for-beginners-ask-a-question-you-can-answer-with-data">データで回答できる質問をする</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio/data-science-for-beginners-predict-an-answer-with-a-simple-model">単純なモデルで回答を予測する</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/studio/data-science-for-beginners-copy-other-peoples-work-to-do-data-science">他のユーザーの成果物をコピーしてデータ サイエンスを実行する</a></li></ul></blockquote></li></ul><hr><h2 id="導入検討向け参考サイト"><a href="#導入検討向け参考サイト" class="headerlink" title="導入検討向け参考サイト"></a>導入検討向け参考サイト</h2><p>Azure Machine Learning の導入によるメリットや考慮事項、事例など。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/data-guide/technology-choices/data-science-and-machine-learning">Microsoft の機械学習製品およびテクノロジの比較</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/overview-what-is-machine-learning-studio#ml-studio-classic-vs-azure-machine-learning-studio">Azure Machine Learning と Machine Learning Studio (classic) の違い</a>  </li><li><a href="https://customers.microsoft.com/ja-jp/search?sq=%22Azure%20Machine%20Learning%22&ff=&p=2&so=story_publish_date%20desc">お客様事例の検索 (?sq&#x3D;”Azure Machine Learning”)</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/browse/?terms=Azure%20Machine%20Learning">Azure アーキテクチャ (?terms&#x3D;Azure%20Machine%20Learning)</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/architecture/browse/?products=azure-machine-learning,azure-machine-learning-studio">Azure アーキテクチャ (?products&#x3D;azure-machine-learning%2Cazure-machine-learning-studio)</a></li></ul><hr><h2 id="開発者向け参考サイト"><a href="#開発者向け参考サイト" class="headerlink" title="開発者向け参考サイト"></a>開発者向け参考サイト</h2><p>Azure Machine Learning を使用して機械学習を開発するための API リファレンスやサンプルなど。</p><h3 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h3><ul><li><a href="https://docs.microsoft.com/ja-jp/python/api/overview/azure/ml/?view=azure-ml-py">Azure Machine Learning SDK for Python とは</a>  </li><li><a href="https://github.com/Azure/MachineLearningNotebooks">Azure Machine Learning Python SDK notebooks</a>  </li><li><a href="https://github.com/Azure/azureml-examples">Azure Machine Learning examples</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/samples/browse/?products=azure-machine-learning&languages=python">コード サンプル (?products&#x3D;azure-machine-learning&amp;languages&#x3D;python)</a></li></ul><h3 id="R"><a href="#R" class="headerlink" title="R"></a>R</h3><ul><li><a href="https://azure.github.io/azureml-sdk-for-r/">Azure Machine Learning SDK for R (preview)</a>  </li><li><a href="https://github.com/Azure/azureml-sdk-for-r/tree/master/samples">Azure ML samples</a></li><li><a href="https://docs.microsoft.com/ja-jp/samples/browse/?products=azure-machine-learning&languages=r">コード サンプル (?products&#x3D;azure-machine-learning&amp;languages&#x3D;r)</a></li></ul><h3 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h3><ul><li><a href="https://docs.microsoft.com/ja-jp/cli/azure/ml(v1)?view=azure-cli-latest">Azure CLI Machine Learning 拡張機能 v1 (az ml)</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/cli/azure/ml?view=azure-cli-latest">Azure CLI Machine Learning 拡張機能 v2 (az ml)</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/v1/reference-azure-machine-learning-cli">CLI (v1) のインストールと使用</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-configure-cli?tabs=public">CLI (v2) のインストールと設定</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-manage-workspace-cli">Azure CLI を使用して Azure Machine Learning ワークスペースを管理する</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/samples/browse/?products=azure-machine-learning&languages=azurecli">コード サンプル (?products&#x3D;azure-machine-learning&amp;languages&#x3D;azurecli)</a></li></ul><h3 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h3><ul><li><a href="https://docs.microsoft.com/ja-jp/rest/api/azureml/">Machine Learning REST API リファレンス</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-manage-rest">REST を使用して Azure ML リソースの作成、実行、削除を行う</a>  </li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-train-with-rest">REST を使用してモデルをトレーニングする (プレビュー)</a></li></ul><hr><p><code>変更履歴</code><br><code>2020/04/22 created by Mochizuki</code><br><code>2020/06/08 modified by Mochizuki</code><br><code>2020/06/18 modified by Mochizuki</code><br><code>2020/09/08 modified by Mochizuki</code><br><code>2021/01/27 modified by Mochizuki</code><br><code>2022/06/07 modified by Mochizuki</code><br><br><br>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 適宜追加更新します。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning 全般 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 参考情報 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Azure Machine Learning (AzureML, AML) の FAQ</title>
      <link href="/blog/2020/04/22/FAQ/"/>
      <url>/blog/2020/04/22/FAQ/</url>
      
        <content type="html"><![CDATA[<p>よくあるご質問とその回答をまとめております。<br>併せて <a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">本サイトについて</a> 、 <a href="https://jpmlblog.github.io/blog/">ホームページ</a> および <a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a> もご参照いただければ幸いです。  </p><span id="more"></span><br><hr><h4 id="製品を理解するために参考となる公開情報を教えて欲しい"><a href="#製品を理解するために参考となる公開情報を教えて欲しい" class="headerlink" title="製品を理解するために参考となる公開情報を教えて欲しい"></a>製品を理解するために参考となる公開情報を教えて欲しい</h4><details><summary style="font-size: 10pt">回答</summary><p>別途ブログ記事として掲載しております。以下リンクより参照ください。<br><a href="https://jpmlblog.github.io/blog/2020/04/22/reference-websites/">参考となる公開情報について</a>  </p></details><hr><h4 id="価格ページでは利用可能なはずの仮想マシンが使用できない"><a href="#価格ページでは利用可能なはずの仮想マシンが使用できない" class="headerlink" title="価格ページでは利用可能なはずの仮想マシンが使用できない"></a>価格ページでは利用可能なはずの仮想マシンが使用できない</h4><details><summary style="font-size: 10pt">回答</summary><p><a href="https://azure.microsoft.com/ja-jp/pricing/details/machine-learning/">こちら</a> のサイトより、各リージョンで利用可能な VM のサイズをご確認頂けます。ただし、利用にはクォータの拡張が必要な場合があります。  </p><p>例えば、東日本リージョンで NCsv3 シリーズの VM を専用コアとして使用する場合、既定ではクォータが割り当てられていないため作成できません。以下サイトに従い、クォータの増加を要求ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-manage-quotas#request-quota-increases">クォータの増加を要求</a></p></details><hr><h4 id="Machine-Learning-ワークスペースを別のリソース-グル―プまたは別のサブスクリプションに移動することは可能か"><a href="#Machine-Learning-ワークスペースを別のリソース-グル―プまたは別のサブスクリプションに移動することは可能か" class="headerlink" title="Machine Learning ワークスペースを別のリソース グル―プまたは別のサブスクリプションに移動することは可能か"></a>Machine Learning ワークスペースを別のリソース グル―プまたは別のサブスクリプションに移動することは可能か</h4><details><summary style="font-size: 10pt">回答</summary><p>不可能です。参考となる情報を紹介します。<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-workspace#workspace-management">Azure Machine Learning ワークスペースとは (#workspace-management)</a>  </p><blockquote><p>! 警告<br>Azure Machine Learning ワークスペースを別のサブスクリプションに移動したり、所有するサブスクリプションを新しいテナントに移動したりすることは、サポートされていません。 エラーの原因になります。</p></blockquote></details><hr><h4 id="セキュリティ要件のため各リソースへのアクセスを制限することは可能か"><a href="#セキュリティ要件のため各リソースへのアクセスを制限することは可能か" class="headerlink" title="セキュリティ要件のため各リソースへのアクセスを制限することは可能か"></a>セキュリティ要件のため各リソースへのアクセスを制限することは可能か</h4><details><summary style="font-size: 10pt">回答</summary><p>認証やアクセス権の付与、ネットワーク的な隔離、監視など、Azure Machine Learning で利用できるセキュリティ機能について、以下サイトにて纏めております。<br><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-enterprise-security">Azure Machine Learning のエンタープライズ セキュリティ</a>  </p><p>一部抜粋を紹介します。  </p><ul><li><p><strong>ストレージ サービスへのアクセスを制限する</strong><br> 以下サイトに記載の認証方法をサポートしています。<br> <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-access-data#supported-data-storage-service-types">Azure Storage サービスに接続する (#supported-data-storage-service-types)</a></p></li><li><p><strong>Web サービスへのアクセスを制限する</strong><br> TLS 1.2 の有効化、キーベースまたはトークン ベースの認証を有効化する方法があります。<br> <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-secure-web-service">TLS を使用して Azure Machine Learning による Web サービスをセキュリティで保護する</a><br> <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-setup-authentication#web-service-authentication">Azure Machine Learning のリソースとワークフローの認証を設定する (#web-service-authentication)</a>  </p></li><li><p><strong>外部ネットワークからのアクセスを制限する</strong><br> 仮想ネットワークや Private Link を使用する方法があります。<br> <a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-network-security-overview">仮想ネットワークの分離とプライバシーの概要</a><br> <a href="https://docs.microsoft.com/en-gb/azure/machine-learning/how-to-configure-private-link?tabs=azure-resource-manager">Configure Azure Private Link for an Azure Machine Learning workspace</a>  </p><p> 公開情報に記載のない利用方法 (例えば、Azure SQL Server の「ファイアウォールと仮想ネットワーク」機能の使用など) はサポートされておりません。詳細につきましては <a href="https://docs.microsoft.com/en-us/azure/machine-learning/how-to-network-security-overview#limitations">こちら</a> を参照ください。</p></li></ul></details><hr><h4 id="機能の説明にある-「プレビュー」-とは何か"><a href="#機能の説明にある-「プレビュー」-とは何か" class="headerlink" title="機能の説明にある 「プレビュー」 とは何か"></a>機能の説明にある 「プレビュー」 とは何か</h4><details><summary style="font-size: 10pt">回答</summary><p>Azure には、マイクロソフトがお客様のご意見を収集するために提供する、プレビュー版、ベータ版、またはその他のプレリリース版の機能、サービス、ソフトウェア、またはリージョン (以下、「プレビュー」といいます) が含まれる場合があります。以下サイトの使用条件に合意することを条件に、プレビューを使用することができます。  </p><ul><li><a href="https://azure.microsoft.com/ja-jp/support/legal/preview-supplemental-terms/">Microsoft Azure プレビューの追加使用条件</a>    <blockquote><ol><li>「現状有姿のまま」「瑕疵を問わない条件」「提供可能な場合に限り提供しうる形で」提供される  </li><li>サービス レベル契約および限定的保証の対象とはならない</li><li>カスタマー サポートの対象とならない</li><li>随時予告なくプレビューを変更または中止することがある</li><li>「一般向け提供製品」でリリースしないことを選択する場合がある</li></ol></blockquote></li></ul><p>プレビューは開発段階のサービス・機能でもあるため、公開中のドキュメントと異なる仕様があったり、メンテナンスに伴い使用できなくなることがあります。以下のようなご質問につきましては、基本的に Azure サポートから回答を提供することが難しいことをご理解ください。  </p><ul><li>一般サービス提供開始予定</li><li>予期しない動作の原因調査</li><li>公開情報にない仕様の確認</li></ul><p>提供開始となった際には <a href="https://azure.microsoft.com/ja-jp/updates/?status=nowavailable&product=machine-learning-service,machine-learning-studio">Azure の更新情報</a> サイトより通知されます。また、Azure ポータルまたは Azure Machine Learning のポータルで通知される場合もあります。   </p></details><hr><h4 id="コストの見積もり方を知りたい"><a href="#コストの見積もり方を知りたい" class="headerlink" title="コストの見積もり方を知りたい"></a>コストの見積もり方を知りたい</h4><details><summary style="font-size: 10pt">回答</summary><p>コストの見積もり例について下記記事に纏めています。  </p><ul><li><a href="https://jpmlblog.github.io/blog/2020/06/18/AML-estimate-costs/">Azure Machine Learning のコスト見積もりについて</a></li></ul><p>その他、コスト見積もりの参考となる公開情報を紹介します。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-plan-manage-cost">Azure Machine Learning のコストを計画して管理する</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/details/machine-learning/">Azure Machine Learning の価格</a>  </li><li><a href="https://azure.microsoft.com/ja-jp/pricing/calculator/?service=machine-learning-service">料金計算ツール (+Azure Machine Learning)</a></li></ul><p>弊社より見積もりの回答が必要な場合、営業担当のタスクとして対応しております。下記サイトよりご依頼ください。  </p><ul><li><a href="https://azure.microsoft.com/ja-jp/overview/sales-number/">Azure 営業担当者に問い合わせる</a></details></li></ul><hr><h4 id="コンピューティング-インスタンスとコンピューティング-クラスターの違いについて"><a href="#コンピューティング-インスタンスとコンピューティング-クラスターの違いについて" class="headerlink" title="コンピューティング インスタンスとコンピューティング クラスターの違いについて"></a>コンピューティング インスタンスとコンピューティング クラスターの違いについて</h4><details><summary style="font-size: 10pt">回答</summary><p>下記サイトに情報が纏められております。いずれも Microsoft によって管理されるマネージド クラウドベース ワークステーションであり、Azure ポータルのリソースとしては確認することは出来ません。</p><ul><li><p><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-azure-machine-learning-architecture#computes">Azure Machine Learning のしくみ:アーキテクチャと概念 #コンピューティング</a></p><blockquote><p><strong>コンピューティング インスタンス:</strong> コンピューティング インスタンスは、機械学習用にインストールされた複数のツールと環境を含む VM です。 コンピューティング インスタンスの主な用途は、開発ワークステーションです。 セットアップを行うことなく、サンプル ノートブックの実行を開始できます。 コンピューティング インスタンスは、トレーニング ジョブと推論ジョブのコンピューティング先として使用できます。  </p></blockquote><blockquote><p><strong>コンピューティング クラスター:</strong> コンピューティング クラスターは、マルチノード スケーリング機能を備えた VM のクラスターです。 コンピューティング クラスターは、大規模なジョブと運用環境のコンピューティング先に適しています。 クラスターは、ジョブが送信されるときに自動的にスケールアップされます。 トレーニング コンピューティング ターゲットとして、または開発&#x2F;テスト デプロイのために使用します。</p></blockquote></li></ul><p>コンピューティング インスタンス関連情報:  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-compute-instance">Azure Machine Learning コンピューティング インスタンスとは</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-create-manage-compute-instance?tabs=python">Azure Machine Learning コンピューティング インスタンスを作成して管理する</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-deploy-local-container-notebook-vm">Azure Machine Learning コンピューティング インスタンスへのモデルのデプロイ</a></li></ul><p>コンピューティング クラスター関連情報:  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/concept-compute-target">Azure Machine Learning でのコンピューティング先とは</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/how-to-create-attach-compute-cluster?tabs=python">Azure Machine Learning コンピューティング クラスターの作成</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/tutorial-pipeline-batch-scoring-classification">チュートリアル:バッチ スコアリング用の Azure Machine Learning パイプラインを作成する</a></details></li></ul><hr><h4 id="Azure-Machine-Learning-Studio-Classic-と-Azure-Machine-Learning-のデザイナー機能はどのような違いがあるか"><a href="#Azure-Machine-Learning-Studio-Classic-と-Azure-Machine-Learning-のデザイナー機能はどのような違いがあるか" class="headerlink" title="Azure Machine Learning Studio (Classic) と Azure Machine Learning のデザイナー機能はどのような違いがあるか"></a>Azure Machine Learning Studio (Classic) と Azure Machine Learning のデザイナー機能はどのような違いがあるか</h4><details><summary style="font-size: 10pt">回答</summary><p>それぞれ GUI ベースで機械学習を行うサービスとなりますが、新・旧という形では分けられておらず、データの移行にも対応していません。<br>具体的な差異は以下サイトに纏められております。  </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/machine-learning/compare-azure-ml-to-studio-classic">Azure Machine Learning と Machine Learning Studio (classic) の違い</a></details></li></ul><hr><h4 id="リソース名に平仮名や漢字を使用可能か"><a href="#リソース名に平仮名や漢字を使用可能か" class="headerlink" title="リソース名に平仮名や漢字を使用可能か"></a>リソース名に平仮名や漢字を使用可能か</h4><details><summary style="font-size: 10pt">回答</summary><p>使用可能な文字はありますが、予期せぬエラーが発生しリソース作成が失敗する場合があるため、推奨しません。  </p><p>リソース グループ名やリソース名には、有効な文字を指定させていただいております。下記情報に従い、リソース グループ名を英数字とハイフンのみを使用して作成ください。   </p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/azure-resource-manager/management/resource-name-rules#microsoftmachinelearningservices">Microsoft.MachineLearningServices</a><blockquote><p>Microsoft.MachineLearningServices  </p><table><thead><tr><th align="left">Entity</th><th align="left">Scope</th><th align="left">長さ</th><th align="left">有効な文字</th></tr></thead><tbody><tr><td align="left">workspaces&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">resource group&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">3-33&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">英数字とハイフン。</td></tr><tr><td align="left">workspaces &#x2F; computes&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">ワークスペース&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">2-16&amp;nbsp;&amp;nbsp;&amp;nbsp;</td><td align="left">英数字とハイフン。</td></tr></tbody></table></blockquote></details></li></ul><hr><h4 id="コンピューティング-インスタンスを自動で停止させたい"><a href="#コンピューティング-インスタンスを自動で停止させたい" class="headerlink" title="コンピューティング インスタンスを自動で停止させたい"></a>コンピューティング インスタンスを自動で停止させたい</h4><details><summary style="font-size: 10pt">回答</summary><p>Azure Functions を使用して、特定の時間に停止させる方法を以下記事にて公開しております。  </p><ul><li><a href="https://jpmlblog.github.io/blog/2020/09/24/AML-functions-autostop/">Azure Functions を使用してコンピューティング インスタンスを自動停止する方法について</a>  </details></li></ul><hr><h4 id="※-適宜追加予定"><a href="#※-適宜追加予定" class="headerlink" title="※ 適宜追加予定"></a>※ 適宜追加予定</h4><details><summary style="font-size: 10pt">回答</summary></details><br>※ 適宜追加更新します。  <hr><p><code>変更履歴</code><br><code>2020/04/22 created by Mochizuki</code><br><code>2020/06/18 modified by Mochizuki</code><br><code>2020/08/26 modified by Mochizuki</code><br><code>2020/10/12 modified by Mochizuki</code><br><code>2020/10/29 modified by Mochizuki</code><br><br><br>※ 本記事は 「<a href="https://jpmlblog.github.io/blog/2020/01/01/about-jpmlblog/">jpmlblog について</a>」 の留意事項に準じます。<br>※ 併せて 「<a href="https://jpmlblog.github.io/blog/">ホームページ</a>」 および 「<a href="https://jpmlblog.github.io/blog/archives/">記事一覧</a>」 もご参照いただければ幸いです。  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning 全般 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FAQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自動機械学習 (AutoML) の同時実行数制限について</title>
      <link href="/blog/2020/04/06/AML-limitation-of-AutoML-concurrency/"/>
      <url>/blog/2020/04/06/AML-limitation-of-AutoML-concurrency/</url>
      
        <content type="html"><![CDATA[<p><a href="https://ml.azure.com/">Microsoft Azure Machine Learning ポータル</a> より Automated Machine Learninig (以降、AutoML と記載) を複数同時実行する際の制限事項について紹介します。  </p><span id="more"></span><br><hr><p>AutoML の実行にはワークスペース単位で同時実行できる数に制限が存在します。明確に同時実行が可能な数が設定されているものではなく、AutoML の実行に関連するリソースへの負荷が一定値を上回った場合に実行が制限される動作となります。サービス側内部構造上、主にリソース間のコミュニケーションを中継するネットワーク リソースに負荷が集中する仕組みとなっています。</p><p>以下図はトレーニング実行時のデータ フローの例です。Training Compute はサイズ変更が可能ですが、それ以外のデータを処理するリソース (通信経路上のネットワーク リソース等) の処理能力をスケール アップすることができないため、負荷が高まることで応答が遅延またはエラーが返され、処理がストップする場合があります。 </p><p><img src="https://docs.microsoft.com/ja-jp/azure/machine-learning/media/concept-enterprise-security/training-and-metrics.png" alt="トレーニング時のデータフロー例"></p><p>現在、リソース間の不要なポーリング等を減らして同時実行数の向上を計るなど対応を検討しています。将来的に 100 程度の同時実行が許容できる見込みです。推奨としては、1 ワークスペース 50 の同時実行を目安に運用をご検討ください。  </p><blockquote><p>注意<br>データセンター側の物理的なリソース不足に起因して同時実行が失敗する場合もあります。タイミングによっては許容される同時実行数が少なくなる場合があることをご留意ください。</p></blockquote><hr><p><code>変更履歴</code><br><code>2020/04/06 created by Mochizuki</code>  </p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Automated Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jpmlblog について</title>
      <link href="/blog/2020/01/01/about-jpmlblog/"/>
      <url>/blog/2020/01/01/about-jpmlblog/</url>
      
        <content type="html"><![CDATA[<p>日本マイクロソフトの Azure Machine Learning に関するサポート情報のブログです。</p><h3 id="公開日"><a href="#公開日" class="headerlink" title="公開日"></a>公開日</h3><p>2020 年 1 月 1 日より公開いたしました。</p><h3 id="活動について"><a href="#活動について" class="headerlink" title="活動について"></a>活動について</h3><p>製品のサポート メンバーによって運用されております。仕様に関する情報やトラブル シューティングの手順、実装におけるワンポイント アドバイスを公開いたします。</p><h3 id="留意事項"><a href="#留意事項" class="headerlink" title="留意事項"></a>留意事項</h3><p>サイトのコンテンツや情報において、可能な限り正確な情報を掲載し、更新するよう努めております。しかしながら、状況の変化や情報が古くなることにより、必ずしもお客様環境に適用できない情報となる場合がございます。恐れ入りますが、予めご留意くださいますようお願い申し上げます。</p>]]></content>
      
      
      <categories>
          
          <category> Azure Machine Learning 全般 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> はじめに </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
